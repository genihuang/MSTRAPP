!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@allianz/ngx-ndbx/formfield"),require("@angular/core"),require("@angular/forms"),require("@angular/cdk/coercion"),require("@allianz/ngx-ndbx/input"),require("@angular/cdk/keycodes")):"function"==typeof define&&define.amd?define("@allianz/ngx-ndbx/mask",["exports","@angular/common","@allianz/ngx-ndbx/formfield","@angular/core","@angular/forms","@angular/cdk/coercion","@allianz/ngx-ndbx/input","@angular/cdk/keycodes"],t):t((e.allianz=e.allianz||{},e.allianz["ngx-ndbx"]=e.allianz["ngx-ndbx"]||{},e.allianz["ngx-ndbx"].mask={}),e.ng.common,e.allianz["ngx-ndbx"].formfield,e.ng.core,e.ng.forms,e.ng.cdk.coercion,e.allianz["ngx-ndbx"].input,e.ng.cdk.keycodes)}(this,function(e,t,n,i,a,o,r,u){"use strict";var s={provide:a.NG_VALUE_ACCESSOR,useExisting:i.forwardRef(function(){return p}),multi:!0},l={provide:a.NG_VALIDATORS,useExisting:i.forwardRef(function(){return p}),multi:!0},p=function(){function e(e){this._elementRef=e,this._separators=["/","(",")",".",":","-"," ","+",","],this._dropSpecialCharacters=!1,this._position=null,this._validateMask=!0,this._onChangeCallback=function(e){},this._onTouchedCallback=function(){},this._validatorOnChange=function(){}}return Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(e){e||(e=""),e!==this._mask&&(this._mask=e,this.updateValue(this.getMaskedString(this._elementRef.nativeElement.value)),this._validatorOnChange())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"separators",{get:function(){return this._separators},set:function(e){this._separators=e,this.updateValue(this.getMaskedString(this._elementRef.nativeElement.value)),this._validatorOnChange()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropSpecialCharacters",{get:function(){return this._dropSpecialCharacters},set:function(e){var t=o.coerceBooleanProperty(e);t!==this._dropSpecialCharacters&&(this._dropSpecialCharacters=t,this.updateValue(this.getMaskedString(this._elementRef.nativeElement.value)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"validateMask",{get:function(){return this._validateMask},set:function(e){var t=o.coerceBooleanProperty(e);t!==this._validateMask&&(this._validateMask=t,this._validatorOnChange())},enumerable:!0,configurable:!0}),e.prototype.getUnmaskedValue=function(){return this.separators.reduce(function(e,t){return e.split(t).join("")},this._elementRef.nativeElement.value)},e.prototype._onKeydown=function(e){var t=e.keyCode,n=e.location,i=e.target,a=this._elementRef.nativeElement.value;if(i.selectionStart!==i.selectionEnd){for(var o=i.selectionStart;this.isSeparator(this._mask[o]);)o++;var r=this._isKeyCodeAllowed(t,n,this.mask[o])?this._calculateCursorShift(i.selectionStart):0;this._position=i.selectionStart+r}else if(t===u.BACKSPACE||t===u.DELETE){var s=t===u.BACKSPACE?1:0,l=a.substring(i.selectionStart-s,i.selectionEnd-s+1);i.selectionStart===a.length-1+s?(this.updateValue(a.substring(0,a.length-1)),e.preventDefault()):this.isSeparator(l)?(i.setSelectionRange(i.selectionStart-s,i.selectionEnd-s),e.preventDefault()):this._position=i.selectionStart-s}else{this._position=i.selectionStart;for(o=i.selectionStart;this.isSeparator(this._mask[o]);)o++;this._isKeyCodeAllowed(t,n,this._mask[o])&&(a.length===this.mask.length?(i.setSelectionRange(o,o),e.preventDefault()):this._position=o+1)}},e.prototype._calculateCursorShift=function(e){var t=0,n=!1;for(this.isSeparator(this.mask[e+t])||(t++,n=!0);this.isSeparator(this.mask[e+t]);)t++;return n||t++,t},e.prototype._keyCodeIsNumber=function(e,t){return e>=u.ZERO&&e<=u.NINE||3===t&&e>=u.NUMPAD_ZERO&&e<=u.NUMPAD_NINE},e.prototype._keyCodeIsLetter=function(e){return e>=u.A&&e<=u.Z},e.prototype._isKeyCodeAllowed=function(e,t,n){return!!("0"===n&&this._keyCodeIsNumber(e,t)||"A"===n&&(this._keyCodeIsNumber(e,t)||this._keyCodeIsLetter(e))||"S"===n&&this._keyCodeIsLetter(e))},e.prototype._isStringAllowed=function(e,t){return!!("0"===t&&/^[0-9]{1}$/.test(e)||"A"===t&&/^[a-zA-Z0-9]{1}$/.test(e)||"S"===t&&/^[a-zA-Z]{1}$/.test(e))},e.prototype._onInputChange=function(e){var t=e.target;this.updateValue(this.getMaskedString(t.value)),null!==this._position&&(t.setSelectionRange(this._position,this._position),this._position=null)},e.prototype._onPaste=function(e){var t=e.target,n=(e.clipboardData||window.clipboardData).getData("text"),i=this.getMaskedString(n,t.selectionStart);this._position=t.selectionStart+i.length},e.prototype.updateValue=function(e){this._elementRef.nativeElement.value=e,this.dropSpecialCharacters?this._onChangeCallback(this.getUnmaskedValue()):this._onChangeCallback(e)},e.prototype.getMaskedString=function(e,t){void 0===t&&(t=0);for(var n="",i=t,a=0,o=0;this.isSeparator(this.mask[i]);)n+=this.mask[i],i++;for(;a<e.length;)for(this._isStringAllowed(e[a],this.mask[i])?(n+=e[a],a++,i++):a++;this.isSeparator(this.mask[i]);)n+=this.mask[i],i===this._position+o&&o++,i++;return 0<o&&(this._position=this._position+o),n},e.prototype.isSeparator=function(e){return-1!==this._separators.indexOf(e)},e.prototype.writeValue=function(e){e||(e=""),this.updateValue(this.getMaskedString(e))},e.prototype.registerOnChange=function(e){this._onChangeCallback=e},e.prototype.registerOnTouched=function(e){this._onTouchedCallback=e},e.prototype.registerOnValidatorChange=function(e){this._validatorOnChange=e},e.prototype._validateFn=function(){var e=this._elementRef.nativeElement.value.length,t=this._mask.length;return e!==t?{nxMaskLengthError:{length:t,actual:e}}:null},e.prototype.validate=function(){return this.validateMask?this._validateFn():null},e.decorators=[{type:i.Directive,args:[{selector:"input[nxMask]",host:{"(input)":"_onInputChange($event)","(keydown)":"_onKeydown($event)","(paste)":"_onPaste($event)","(blur)":"_onTouchedCallback()"},exportAs:"nxMaskDirective",providers:[s,{provide:r.NX_INPUT_VALUE_ACCESSOR,useExisting:e},l]}]}],e.ctorParameters=function(){return[{type:i.ElementRef}]},e.propDecorators={mask:[{type:i.Input,args:["nxMask"]}],separators:[{type:i.Input}],dropSpecialCharacters:[{type:i.Input}],validateMask:[{type:i.Input}]},e}(),c=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{imports:[t.CommonModule,n.NxFormfieldModule],declarations:[p],exports:[n.NxFormfieldModule,p]}]}],e}();e.NxMaskModule=c,e.NX_MASK_VALUE_ACCESSOR=s,e.NX_MASK_VALIDATORS=l,e.NxMaskDirective=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=allianz-ngx-ndbx-mask.umd.min.js.map