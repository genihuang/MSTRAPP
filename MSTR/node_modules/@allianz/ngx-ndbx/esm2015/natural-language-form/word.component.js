/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NxFormfieldControl, NxFormfieldErrorDirective } from '@allianz/ngx-ndbx/formfield';
import { getFontShorthand } from '@allianz/ngx-ndbx/utils';
import { Overlay } from '@angular/cdk/overlay';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ContentChildren, ElementRef, HostBinding, Input, QueryList, Renderer2, ViewChild } from '@angular/core';
import { startWith } from 'rxjs/operators';
import { Subject, Subscription } from 'rxjs';
import { NxPopoverTriggerDirective } from '@allianz/ngx-ndbx/popover';
import { NxDropdownComponent } from '@allianz/ngx-ndbx/dropdown';
export class NxWordComponent {
    /**
     * @param {?} elementRef
     * @param {?} _changeDetectorRef
     * @param {?} _renderer
     * @param {?} _overlay
     */
    constructor(elementRef, _changeDetectorRef, _renderer, _overlay) {
        this.elementRef = elementRef;
        this._changeDetectorRef = _changeDetectorRef;
        this._renderer = _renderer;
        this._overlay = _overlay;
        this.subscription = Subscription.EMPTY;
        this.subscriptionValues = Subscription.EMPTY;
        /**
         * \@docs-private
         */
        this.hasErrors = false;
        /**
         * \@docs-private
         */
        this.inputChanges = new Subject();
        /**
         * \@docs-private
         */
        this.currentTextWidth = 0;
        // this will apply different min-widths to our component through our styles
        /**
         * Provide a hint for a minimal width. The actual size will be determined for inputs for each change.
         */
        this.size = 'regular';
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this._validateControlChild();
        this.subscription = this._control.stateChanges.pipe(startWith(null)).subscribe((/**
         * @return {?}
         */
        () => {
            this.hasErrors = this._control.errorState;
            this._changeDetectorRef.markForCheck();
        }));
        // if we have a ngcontrol available stick to its valueChanges subject
        if (this._control.ngControl) {
            this.subscriptionValues = this._control.ngControl.valueChanges.subscribe((/**
             * @param {?} value
             * @return {?}
             */
            value => {
                this.updateCurrentTextWidth();
                this.inputChanges.next();
            }));
            // in any other case it is a bre input and input changes are signaled through simple state changes
        }
        else {
            this.subscriptionValues = this._control.stateChanges.subscribe((/**
             * @param {?} value
             * @return {?}
             */
            value => {
                this.updateCurrentTextWidth();
                this.inputChanges.next();
            }));
        }
        this._control.setAriaLabel(this.label);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
    /**
     * \@docs-private
     * Calculate the width of the full text given by the input,
     * that value is bound to this component so it can grow.
     * The involved input is known to have a width of 100% an will fit the additional space given
     * which completes the auto growing behavior.
     * @return {?}
     */
    updateCurrentTextWidth() {
        // provide the canvas only lazy
        if (!this.measureCanvas) {
            this.measureCanvas = this._renderer.createElement('canvas');
        }
        /** @type {?} */
        const ctx = this.measureCanvas.getContext('2d');
        /** @type {?} */
        const inputRef = this._control.elementRef;
        /** @type {?} */
        const styles = window.getComputedStyle(inputRef.nativeElement);
        ctx.font = getFontShorthand(styles);
        /** @type {?} */
        const metrics = ctx.measureText(this._control.value);
        // add 1px (cursor width) to prevent jumping of the text on blur.
        /** @type {?} */
        const newWidth = metrics.width + parseInt(styles.paddingRight, 10) + parseInt(styles.paddingLeft, 10) + 1;
        // This should be injected via @Host to get an exact reference to NxNaturalLanguageFormComponent
        // Works as promised as long as there is not other tag around the word. Not expected but possible.
        /** @type {?} */
        const parent = this.elementRef.nativeElement.parentElement;
        /** @type {?} */
        const parentMeasurement = parent.getBoundingClientRect();
        // Limit to own given minimal width
        this.currentTextWidth = Math.max(parseInt(styles.minWidth, 10), newWidth);
        // Limit to container width
        this.currentTextWidth = Math.min(this.currentTextWidth, parentMeasurement.width);
        this._popover.updatePosition();
    }
    /**
     * \@docs-private
     * @return {?}
     */
    repositionError() {
        if (this._popover) {
            this._popover.updatePosition();
        }
    }
    // Fail if the required control is missing.
    /**
     * @protected
     * @return {?}
     */
    _validateControlChild() {
        if (!this._control) {
            throw new Error('NxWordComponent requires an NxFormfieldControl compatible input.');
        }
    }
    /**
     * \@docs-private
     * @return {?}
     */
    getConnectedOverlayOrigin() {
        return this.elementRef;
    }
    /**
     * \@docs-private
     * @return {?}
     */
    get isFocused() {
        return this._control.focused;
    }
    /**
     * \@docs-private
     * @return {?}
     */
    get isFilled() {
        return !this._control.empty;
    }
    /**
     * \@docs-private
     * @return {?}
     */
    get hasDropdown() {
        return Boolean(this._dropdown);
    }
}
NxWordComponent.decorators = [
    { type: Component, args: [{
                selector: 'nx-word',
                template: "<div\n  class=\"nx-word__input-wrapper\"\n  [nxPopoverTriggerFor]=\"popoverHover\"\n  nxPopoverTrigger='manual'\n  nxPopoverCloseable=\"false\"\n  nxPopoverDirection=\"top\"\n  [nxPopoverShow]=\"hasErrors && _errorChildren.length > 0\">\n\n  <!-- We only allow formfield controls here -->\n  <div *ngIf=\"!hasDropdown\" class=\"nx-word__inner-wrapper\">\n    <ng-content select=\"[nxInput]\"></ng-content>\n  </div>\n  <ng-content select=\"nx-dropdown\"></ng-content>\n</div>\n\n<nx-popover #popoverHover>\n  <ng-content select=\"[nxError]\"></ng-content>\n</nx-popover>\n",
                host: {
                    '[class.size-short]': 'size == "short"',
                    '[class.size-regular]': 'size == "regular"',
                    '[class.size-long]': 'size == "long"',
                    '[class.has-error]': 'hasErrors',
                    '[class.is-focused]': 'isFocused',
                    '[class.is-filled]': 'isFilled',
                    '[class.has-dropdown]': 'hasDropdown',
                },
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host{display:inline-block;position:relative;font-weight:400;text-align:center;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;width:100%}:host .nx-word__inner-wrapper{border-bottom:2px solid #d9d9d9}:host.size-short{min-width:80px}:host.size-regular{min-width:152px}:host.size-long{min-width:360px}@media (max-width:991px){:host.size-long{min-width:280px}}@media (max-width:703px){:host.size-long{min-width:248px}}:host ::ng-deep .c-input{display:inline-block;text-align:inherit;font-size:inherit;line-height:inherit;background:0 0;color:inherit;border:none;outline:0;margin:0;width:100%;max-width:100%;height:auto;box-shadow:none;padding:0 8px}:host ::ng-deep .c-input.is-focused{outline:0;box-shadow:none;border-bottom-width:2px}:host ::ng-deep .c-input.is-filled,:host ::ng-deep .c-input.is-focused{color:#006192;font-weight:400}:host ::ng-deep .c-input.is-disabled{cursor:not-allowed}:host ::ng-deep .c-input::-ms-clear{display:none}:host ::ng-deep nx-dropdown{position:relative;border-bottom:2px solid #d9d9d9}:host ::ng-deep nx-dropdown .nx-dropdown__container{font-size:inherit;margin-bottom:-2px}:host ::ng-deep nx-dropdown.is-filled{border-color:#007ab3;color:#006192}:host ::ng-deep nx-dropdown .nx-dropdown__icon{line-height:inherit}:host ::ng-deep .nx-word__input-wrapper{width:100%}:host(.is-filled) .nx-word__inner-wrapper,:host(.is-focused) .nx-word__inner-wrapper{border-color:#007ab3}:host(.has-error) .nx-word__inner-wrapper{border-color:#dc3149}:host.has-error ::ng-deep nx-dropdown{color:#dc3149;border-color:#dc3149}:host.has-error ::ng-deep .c-input.has-error{color:#dc3149}:host-context(.is-negative) ::ng-deep .nx-dropdown,:host-context(.is-negative) ::ng-deep nx-dropdown,:host-context(.is-negative) ::ng-deep nx-dropdown.is-filled{border-color:#fff;color:#fff}:host-context(.is-negative) ::ng-deep .c-input{color:#fff}:host-context(.is-negative) .nx-word__inner-wrapper{border-color:#fff}.nx-word__inner-wrapper{height:52px}@media (max-width:991px){:host ::ng-deep nx-dropdown .nx-dropdown__container{font-size:26px}.nx-word__inner-wrapper{height:36px}}:host-context(.nx-natural-language-form--small) .nx-word__inner-wrapper{height:36px}:host-context(.nx-natural-language-form--small) ::ng-deep nx-dropdown .nx-dropdown__container{margin-bottom:2px}"]
            }] }
];
/** @nocollapse */
NxWordComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: Renderer2 },
    { type: Overlay }
];
NxWordComponent.propDecorators = {
    _control: [{ type: ContentChild, args: [NxFormfieldControl,] }],
    _errorChildren: [{ type: ContentChildren, args: [NxFormfieldErrorDirective,] }],
    _popover: [{ type: ViewChild, args: [NxPopoverTriggerDirective,] }],
    _dropdown: [{ type: ContentChild, args: [NxDropdownComponent,] }],
    currentTextWidth: [{ type: HostBinding, args: ['style.width.px',] }],
    size: [{ type: Input, args: ['nxSize',] }],
    label: [{ type: Input, args: ['nxLabel',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype.subscription;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype.subscriptionValues;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.hasErrors;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype.measureCanvas;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.inputChanges;
    /** @type {?} */
    NxWordComponent.prototype._control;
    /** @type {?} */
    NxWordComponent.prototype._errorChildren;
    /** @type {?} */
    NxWordComponent.prototype._popover;
    /** @type {?} */
    NxWordComponent.prototype._dropdown;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.currentTextWidth;
    /**
     * Provide a hint for a minimal width. The actual size will be determined for inputs for each change.
     * @type {?}
     */
    NxWordComponent.prototype.size;
    /**
     * A word doesn't have a set place to show labels.
     * In order to be accessible, you have to provide a label with this property.
     * It will be attached to the given input through `aria-label`.
     * @type {?}
     */
    NxWordComponent.prototype.label;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._changeDetectorRef;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._overlay;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29yZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxsaWFuei9uZ3gtbmRieC8iLCJzb3VyY2VzIjpbIm5hdHVyYWwtbGFuZ3VhZ2UtZm9ybS93b3JkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLHlCQUF5QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDNUYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDM0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9DLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxZQUFZLEVBQ1osZUFBZSxFQUNmLFVBQVUsRUFDVixXQUFXLEVBQ1gsS0FBSyxFQUVMLFNBQVMsRUFDVCxTQUFTLEVBQ1QsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsT0FBTyxFQUFJLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUvQyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQXdCakUsTUFBTSxPQUFPLGVBQWU7Ozs7Ozs7SUFpQzFCLFlBRVMsVUFBc0IsRUFDckIsa0JBQXFDLEVBQ3JDLFNBQW9CLEVBQ3BCLFFBQWlCO1FBSGxCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDckIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFtQjtRQUNyQyxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ3BCLGFBQVEsR0FBUixRQUFRLENBQVM7UUFyQ25CLGlCQUFZLEdBQWlCLFlBQVksQ0FBQyxLQUFLLENBQUM7UUFDaEQsdUJBQWtCLEdBQWlCLFlBQVksQ0FBQyxLQUFL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Z0JBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O2FBQ2hEOzs7O1lBbENDLFVBQVU7WUFKVixpQkFBaUI7WUFTakIsU0FBUztZQWJGLE9BQU87Ozt1QkF3RGIsWUFBWSxTQUFDLGtCQUFrQjs2QkFDL0IsZUFBZSxTQUFDLHlCQUF5Qjt1QkFDekMsU0FBUyxTQUFDLHlCQUF5Qjt3QkFDbkMsWUFBWSxTQUFDLG1CQUFtQjsrQkFHaEMsV0FBVyxTQUFDLGdCQUFnQjttQkFNNUIsS0FBSyxTQUFDLFFBQVE7b0JBT2QsS0FBSyxTQUFDLFNBQVM7Ozs7Ozs7SUE5QmhCLHVDQUF3RDs7Ozs7SUFDeEQsNkNBQThEOzs7OztJQUc5RCxvQ0FBa0M7Ozs7O0lBRWxDLHdDQUF5Qzs7Ozs7SUFHekMsdUNBQWtDOztJQUVsQyxtQ0FBb0U7O0lBQ3BFLHlDQUFpRzs7SUFDakcsbUNBQTBFOztJQUMxRSxvQ0FBa0U7Ozs7O0lBR2xFLDJDQUM2Qjs7Ozs7SUFLN0IsK0JBQXlDOzs7Ozs7O0lBT3pDLGdDQUFnQzs7Ozs7SUFJOUIscUNBQTZCOzs7OztJQUM3Qiw2Q0FBNkM7Ozs7O0lBQzdDLG9DQUE0Qjs7Ozs7SUFDNUIsbUNBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTnhGb3JtZmllbGRDb250cm9sLCBOeEZvcm1maWVsZEVycm9yRGlyZWN0aXZlIH0gZnJvbSAnQGFsbGlhbnovbmd4LW5kYngvZm9ybWZpZWxkJztcbmltcG9ydCB7IGdldEZvbnRTaG9ydGhhbmQgfSBmcm9tICdAYWxsaWFuei9uZ3gtbmRieC91dGlscyc7XG5pbXBvcnQgeyBPdmVybGF5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFbGVtZW50UmVmLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgUXVlcnlMaXN0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHN0YXJ0V2l0aCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFN1YmplY3QgLCAgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IE54UG9wb3ZlclRyaWdnZXJEaXJlY3RpdmUgfSBmcm9tICdAYWxsaWFuei9uZ3gtbmRieC9wb3BvdmVyJztcbmltcG9ydCB7IE54RHJvcGRvd25Db21wb25lbnQgfSBmcm9tICdAYWxsaWFuei9uZ3gtbmRieC9kcm9wZG93bic7XG5cbi8qKiBUeXBlIHRvIGRldGVybWluZSB0aGUgbWluaW1hbCB3aWR0aCBvZiBhIHdvcmQuICovXG5leHBvcnQgdHlwZSBTSVpFUyA9ICdyZWd1bGFyJyB8ICdzaG9ydCcgfCAnbG9uZyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ254LXdvcmQnLFxuICB0ZW1wbGF0ZVVybDogJ3dvcmQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFtcbiAgICAnd29yZC5jb21wb25lbnQuc2NzcydcbiAgXSxcbiAgaG9zdDoge1xuICAgICdbY2xhc3Muc2l6ZS1zaG9ydF0nOiAnc2l6ZSA9PSBcInNob3J0XCInLFxuICAgICdbY2xhc3Muc2l6ZS1yZWd1bGFyXSc6ICdzaXplID09IFwicmVndWxhclwiJyxcbiAgICAnW2NsYXNzLnNpemUtbG9uZ10nOiAnc2l6ZSA9PSBcImxvbmdcIicsXG4gICAgJ1tjbGFzcy5oYXMtZXJyb3JdJzogJ2hhc0Vycm9ycycsXG4gICAgJ1tjbGFzcy5pcy1mb2N1c2VkXSc6ICdpc0ZvY3VzZWQnLFxuICAgICdbY2xhc3MuaXMtZmlsbGVkXSc6ICdpc0ZpbGxlZCcsXG4gICAgJ1tjbGFzcy5oYXMtZHJvcGRvd25dJzogJ2hhc0Ryb3Bkb3duJyxcblxuICB9LFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5cbmV4cG9ydCBjbGFzcyBOeFdvcmRDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3kge1xuICBwcml2YXRlIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gU3Vic2NyaXB0aW9uLkVNUFRZO1xuICBwcml2YXRlIHN1YnNjcmlwdGlvblZhbHVlczogU3Vic2NyaXB0aW9uID0gU3Vic2NyaXB0aW9uLkVNUFRZO1xuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIHB1YmxpYyBoYXNFcnJvcnM6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIG1lYXN1cmVDYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIGlucHV0Q2hhbmdlcyA9IG5ldyBTdWJqZWN0PGFueT4oKTtcblxuICBAQ29udGVudENoaWxkKE54Rm9ybWZpZWxkQ29udHJvbCkgX2NvbnRyb2w6IE54Rm9ybWZpZWxkQ29udHJvbDxhbnk+O1xuICBAQ29udGVudENoaWxkcmVuKE54Rm9ybWZpZWxkRXJyb3JEaXJlY3RpdmUpIF9lcnJvckNoaWxkcmVuOiBRdWVyeUxpc3Q8TnhGb3JtZmllbGRFcnJvckRpcmVjdGl2ZT47XG4gIEBWaWV3Q2hpbGQoTnhQb3BvdmVyVHJpZ2dlckRpcmVjdGl2ZSkgX3BvcG92ZXI6IE54UG9wb3ZlclRyaWdnZXJEaXJlY3RpdmU7XG4gIEBDb250ZW50Q2hpbGQoTnhEcm9wZG93bkNvbXBvbmVudCkgX2Ryb3Bkb3duOiBOeERyb3Bkb3duQ29tcG9uZW50O1xuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIEBIb3N0QmluZGluZygnc3R5bGUud2lkdGgucHgnKVxuICBjdXJyZW50VGV4dFdpZHRoOiBudW1iZXIgPSAwO1xuXG5cbiAgLy8gdGhpcyB3aWxsIGFwcGx5IGRpZmZlcmVudCBtaW4td2lkdGhzIHRvIG91ciBjb21wb25lbnQgdGhyb3VnaCBvdXIgc3R5bGVzXG4gIC8qKiBQcm92aWRlIGEgaGludCBmb3IgYSBtaW5pbWFsIHdpZHRoLiBUaGUgYWN0dWFsIHNpemUgd2lsbCBiZSBkZXRlcm1pbmVkIGZvciBpbnB1dHMgZm9yIGVhY2ggY2hhbmdlLiAqL1xuICBASW5wdXQoJ254U2l6ZScpIHNpemU6IFNJWkVTID0gJ3JlZ3VsYXInO1xuXG4gIC8qKlxuICAgKiBBIHdvcmQgZG9lc24ndCBoYXZlIGEgc2V0IHBsYWNlIHRvIHNob3cgbGFiZWxzLlxuICAgKiBJbiBvcmRlciB0byBiZSBhY2Nlc3NpYmxlLCB5b3UgaGF2ZSB0byBwcm92aWRlIGEgbGFiZWwgd2l0aCB0aGlzIHByb3BlcnR5LlxuICAgKiBJdCB3aWxsIGJlIGF0dGFjaGVkIHRvIHRoZSBnaXZlbiBpbnB1dCB0aHJvdWdoIGBhcmlhLWxhYmVsYC5cbiAgICovXG4gIEBJbnB1dCgnbnhMYWJlbCcpIGxhYmVsOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgICBwdWJsaWMgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIF9jaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBfcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBwcml2YXRlIF9vdmVybGF5OiBPdmVybGF5XG4gICkgeyB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIHRoaXMuX3ZhbGlkYXRlQ29udHJvbENoaWxkKCk7XG5cbiAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IHRoaXMuX2NvbnRyb2wuc3RhdGVDaGFuZ2VzLnBpcGUoc3RhcnRXaXRoKG51bGwpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5oYXNFcnJvcnMgPSB0aGlzLl9jb250cm9sLmVycm9yU3RhdGU7XG4gICAgICB0aGlzLl9jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICB9KTtcblxuICAgIC8vIGlmIHdlIGhhdmUgYSBuZ2NvbnRyb2wgYXZhaWxhYmxlIHN0aWNrIHRvIGl0cyB2YWx1ZUNoYW5nZXMgc3ViamVjdFxuICAgIGlmICh0aGlzLl9jb250cm9sLm5nQ29udHJvbCkge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb25WYWx1ZXMgPSB0aGlzLl9jb250cm9sLm5nQ29udHJvbC52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgICAgdGhpcy51cGRhdGVDdXJyZW50VGV4dFdpZHRoKCk7XG4gICAgICAgIHRoaXMuaW5wdXRDaGFuZ2VzLm5leHQoKTtcbiAgICAgIH0pO1xuICAgIC8vIGluIGFueSBvdGhlciBjYXNlIGl0IGlzIGEgYnJlIGlucHV0IGFuZCBpbnB1dCBjaGFuZ2VzIGFyZSBzaWduYWxlZCB0aHJvdWdoIHNpbXBsZSBzdGF0ZSBjaGFuZ2VzXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uVmFsdWVzID0gdGhpcy5fY29udHJvbC5zdGF0ZUNoYW5nZXMuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgICAgdGhpcy51cGRhdGVDdXJyZW50VGV4dFdpZHRoKCk7XG4gICAgICAgIHRoaXMuaW5wdXRDaGFuZ2VzLm5leHQoKTtcbiAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgdGhpcy5fY29udHJvbC5zZXRBcmlhTGFiZWwodGhpcy5sYWJlbCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgLyoqXG4gICAgQGRvY3MtcHJpdmF0ZVxuICAgIENhbGN1bGF0ZSB0aGUgd2lkdGggb2YgdGhlIGZ1bGwgdGV4dCBnaXZlbiBieSB0aGUgaW5wdXQsXG4gICAgdGhhdCB2YWx1ZSBpcyBib3VuZCB0byB0aGlzIGNvbXBvbmVudCBzbyBpdCBjYW4gZ3Jvdy5cblxuICAgIFRoZSBpbnZvbHZlZCBpbnB1dCBpcyBrbm93biB0byBoYXZlIGEgd2lkdGggb2YgMTAwJSBhbiB3aWxsIGZpdCB0aGUgYWRkaXRpb25hbCBzcGFjZSBnaXZlblxuICAgIHdoaWNoIGNvbXBsZXRlcyB0aGUgYXV0byBncm93aW5nIGJlaGF2aW9yLlxuICAqL1xuICB1cGRhdGVDdXJyZW50VGV4dFdpZHRoKCkge1xuICAgIC8vIHByb3ZpZGUgdGhlIGNhbnZhcyBvbmx5IGxhenlcbiAgICBpZiAoIXRoaXMubWVhc3VyZUNhbnZhcykge1xuICAgICAgdGhpcy5tZWFzdXJlQ2FudmFzID0gdGhpcy5fcmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgfVxuXG5cbiAgICBjb25zdCBjdHggPSB0aGlzLm1lYXN1cmVDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBjb25zdCBpbnB1dFJlZiA9IHRoaXMuX2NvbnRyb2wuZWxlbWVudFJlZjtcbiAgICBjb25zdCBzdHlsZXMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShpbnB1dFJlZi5uYXRpdmVFbGVtZW50KTtcbiAgICBjdHguZm9udCA9IGdldEZvbnRTaG9ydGhhbmQoc3R5bGVzKTtcblxuICAgIGNvbnN0IG1ldHJpY3MgPSBjdHgubWVhc3VyZVRleHQodGhpcy5fY29udHJvbC52YWx1ZSk7XG4gICAgLy8gYWRkIDFweCAoY3Vyc29yIHdpZHRoKSB0byBwcmV2ZW50IGp1bXBpbmcgb2YgdGhlIHRleHQgb24gYmx1ci5cbiAgICBjb25zdCBuZXdXaWR0aCA9IG1ldHJpY3Mud2lkdGggKyBwYXJzZUludChzdHlsZXMucGFkZGluZ1JpZ2h0LCAxMCkgKyBwYXJzZUludChzdHlsZXMucGFkZGluZ0xlZnQsIDEwKSArIDE7XG5cbiAgICAvLyBUaGlzIHNob3VsZCBiZSBpbmplY3RlZCB2aWEgQEhvc3QgdG8gZ2V0IGFuIGV4YWN0IHJlZmVyZW5jZSB0byBOeE5hdHVyYWxMYW5ndWFnZUZvcm1Db21wb25lbnRcbiAgICAvLyBXb3JrcyBhcyBwcm9taXNlZCBhcyBsb25nIGFzIHRoZXJlIGlzIG5vdCBvdGhlciB0YWcgYXJvdW5kIHRoZSB3b3JkLiBOb3QgZXhwZWN0ZWQgYnV0IHBvc3NpYmxlLlxuICAgIGNvbnN0IHBhcmVudDogSFRNTEVsZW1lbnQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHBhcmVudE1lYXN1cmVtZW50ID0gcGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgLy8gTGltaXQgdG8gb3duIGdpdmVuIG1pbmltYWwgd2lkdGhcbiAgICB0aGlzLmN1cnJlbnRUZXh0V2lkdGggPSBNYXRoLm1heChwYXJzZUludChzdHlsZXMubWluV2lkdGgsIDEwKSwgbmV3V2lkdGgpO1xuXG4gICAgLy8gTGltaXQgdG8gY29udGFpbmVyIHdpZHRoXG4gICAgdGhpcy5jdXJyZW50VGV4dFdpZHRoID0gTWF0aC5taW4odGhpcy5jdXJyZW50VGV4dFdpZHRoLCBwYXJlbnRNZWFzdXJlbWVudC53aWR0aCk7XG4gICAgdGhpcy5fcG9wb3Zlci51cGRhdGVQb3NpdGlvbigpO1xuICB9XG5cbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgcmVwb3NpdGlvbkVycm9yKCkge1xuICAgIGlmICh0aGlzLl9wb3BvdmVyKSB7XG4gICAgICB0aGlzLl9wb3BvdmVyLnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gRmFpbCBpZiB0aGUgcmVxdWlyZWQgY29udHJvbCBpcyBtaXNzaW5nLlxuICBwcm90ZWN0ZWQgX3ZhbGlkYXRlQ29udHJvbENoaWxkKCkge1xuICAgIGlmICghdGhpcy5fY29udHJvbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdOeFdvcmRDb21wb25lbnQgcmVxdWlyZXMgYW4gTnhGb3JtZmllbGRDb250cm9sIGNvbXBhdGlibGUgaW5wdXQuJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgZ2V0Q29ubmVjdGVkT3ZlcmxheU9yaWdpbigpOiBFbGVtZW50UmVmIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVmO1xuICB9XG5cbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgZ2V0IGlzRm9jdXNlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fY29udHJvbC5mb2N1c2VkO1xuICB9XG5cbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgZ2V0IGlzRmlsbGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5fY29udHJvbC5lbXB0eTtcbiAgfVxuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIGdldCBoYXNEcm9wZG93bigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLl9kcm9wZG93bik7XG4gIH1cbn1cbiJdfQ==