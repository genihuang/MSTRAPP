/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ViewChild, InjectionToken, Inject, Optional } from '@angular/core';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ContentChildren, ElementRef, Input, QueryList, ViewEncapsulation, Renderer2 } from '@angular/core';
import { startWith } from 'rxjs/operators';
import { getClassNameList } from '@allianz/ngx-ndbx/utils';
import { NxFormfieldHintDirective } from './hint.directive';
import { NxFormfieldNoteDirective } from './note.directive';
import { NxFormfieldErrorDirective } from './error.directive';
import { NxFormfieldControl } from './formfield-control';
import { NxFormfieldSuffixDirective } from './suffix.directive';
import { NxFormfieldPrefixDirective } from './prefix.directive';
import { NxFormfieldAppendixDirective } from './appendix.directive';
import { NxFormfieldLabelDirective } from './label.directive';
/** @type {?} */
const NX_STYLES = {
    'negative': 'nx-formfield--negative'
};
/**
 * Represents the default options for the form field that can be configured
 * using the `FORMFIELD_DEFAULT_OPTIONS` injection token.
 * @record
 */
export function FormfieldDefaultOptions() { }
if (false) {
    /**
     * Sets the default appearance. (optional)
     * @type {?|undefined}
     */
    FormfieldDefaultOptions.prototype.appearance;
    /**
     * Sets the default float label type. (optional)
     * @type {?|undefined}
     */
    FormfieldDefaultOptions.prototype.nxFloatLabel;
}
/** @type {?} */
export const FORMFIELD_DEFAULT_OPTIONS = new InjectionToken('FORMFIELD_DEFAULT_OPTIONS');
export class NxFormfieldComponent {
    /**
     * @param {?} elementRef
     * @param {?} renderer
     * @param {?} _changeDetectorRef
     * @param {?} _defaultOptions
     */
    constructor(elementRef, renderer, _changeDetectorRef, _defaultOptions) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this._changeDetectorRef = _changeDetectorRef;
        this._defaultOptions = _defaultOptions;
        this._styles = '';
        this._subscriptions = [];
    }
    /**
     * Whether the label should float once the input is focused or filled (auto, default)
     * or force it to always float with a value of always to simulate a more static form.
     * @return {?}
     */
    get floatLabel() {
        return this._floatLabel || (this._defaultOptions && this._defaultOptions.nxFloatLabel) || 'auto';
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set floatLabel(value) {
        if (value !== this._floatLabel) {
            this._floatLabel = value || 'auto';
            this._changeDetectorRef.markForCheck();
        }
    }
    /**
     * Sets the styling of the formfield.
     * If 'negative', a negative set of stylings is used.
     * @param {?} value
     * @return {?}
     */
    set styles(value) {
        if (this._styles === value) {
            return;
        }
        /** @type {?} */
        const classNames = getClassNameList(value, NX_STYLES);
        classNames.forEach((/**
         * @param {?} classStr
         * @return {?}
         */
        classStr => {
            this.renderer.addClass(this.elementRef.nativeElement, classStr);
        }));
        this._styles = value;
    }
    /**
     * **NDBX Expert option**
     *
     * Sets the appearance of the formfield.
     * @param {?} value
     * @return {?}
     */
    set appearance(value) {
        if (this._appearance !== value) {
            this._appearance = value;
            this._changeDetectorRef.markForCheck();
        }
    }
    /**
     * @return {?}
     */
    get appearance() {
        return this._appearance || (this._defaultOptions && this._defaultOptions.appearance) || 'auto';
    }
    /**
     * @return {?}
     */
    get _shouldAlwaysFloat() {
        return this.floatLabel === 'always';
    }
    /**
     * \@docs-private
     * @return {?}
     */
    get shouldLabelFloat() {
        return (this._control.shouldLabelFloat || this._shouldAlwaysFloat);
    }
    /**
     * \@docs-private
     * @return {?}
     */
    get control() {
        return this._control;
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        /** @type {?} */
        let subscription;
        /** @type {?} */
        const subscriptions = [];
        this._validateControlChild();
        // Subscribe to changes in the child control state in order to update the form field UI.
        subscription = this._control.stateChanges.pipe(startWith(null)).subscribe((/**
         * @return {?}
         */
        () => {
            this._syncDescribedByIds();
            this._changeDetectorRef.markForCheck();
        }));
        subscriptions.push(subscription);
        // Re-validate when the number of hints changes.
        subscription = this._hintChildren.changes.pipe(startWith(null)).subscribe((/**
         * @return {?}
         */
        () => {
            this._changeDetectorRef.markForCheck();
        }));
        subscriptions.push(subscription);
        // Update the aria-described by when the number of errors changes.
        subscription = this._errorChildren.changes.pipe(startWith(null)).subscribe((/**
         * @return {?}
         */
        () => {
            this._syncDescribedByIds();
            this._changeDetectorRef.markForCheck();
        }));
        subscriptions.push(subscription);
        this._subscriptions = subscriptions;
    }
    /**
     * @return {?}
     */
    ngAfterContentChecked() {
        this._validateControlChild();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._subscriptions.forEach((/**
         * @param {?} subscription
         * @return {?}
         */
        (subscription) => subscription.unsubscribe()));
    }
    /**
     * \@docs-private
     * @return {?}
     */
    getDisplayedMessage() {
        if (this._control.errorState && this._errorChildren && this._errorChildren.length > 0) {
            return 'error';
        }
        return 'hint';
    }
    /**
     * @private
     * @return {?}
     */
    _syncDescribedByIds() {
        if (this._control) {
            /** @type {?} */
            let ids = [];
            ids = this._noteChildren.map((/**
             * @param {?} hint
             * @return {?}
             */
            hint => hint.id));
            if (this.getDisplayedMessage() === 'hint') {
                ids = [...this._hintChildren.map((/**
                     * @param {?} hint
                     * @return {?}
                     */
                    hint => hint.id)), ...ids];
            }
            else if (this._errorChildren) {
                ids = [...this._errorChildren.map((/**
                     * @param {?} error
                     * @return {?}
                     */
                    error => error.id)), ...ids];
            }
            this._control.setDescribedByIds(ids);
        }
    }
    // Fail if the required control is missing.
    /**
     * @protected
     * @return {?}
     */
    _validateControlChild() {
        if (!this._control) {
            throw new Error('Formfield must contain a NxFormfieldControl like input[nxInput] or a custom implementation');
        }
    }
    /**
     * \@docs-private
     * @return {?}
     */
    getConnectedOverlayOrigin() {
        return this._connectionContainerRef || this.elementRef;
    }
}
NxFormfieldComponent.decorators = [
    { type: Component, args: [{
                selector: 'nx-formfield',
                template: "<!--\nWe are building the following structure.\n\n+-----------------------------+ +-----------+\n| Prefix |   Input   | Suffix | |  Appendix |\n+-----------------------------+ +-----------+\n|-----------------Border--------------------|\n+-------------------------------------------+\n|                 Hints                     |\n+-------------------------------------------+\n|                                           |\n|                Messages                   |\n|                                           |\n+-------------------------------------------+\n\n-->\n\n<div class=\"nx-formfield__wrapper\">\n\n\n  <!-- Give a flex context to properly align suffix, input & postfix -->\n  <div class=\"nx-formfield__row\"  #connectionContainer>\n    <div class=\"nx-formfield__flexfield\">\n      <div class=\"nx-formfield__prefix\" *ngIf=\"_prefixChildren.length\">\n          <ng-content select=\"[nxFormfieldPrefix]\"></ng-content>\n      </div>\n\n      <div class=\"nx-formfield__input\">\n        <ng-content></ng-content>\n\n        <!-- This handles the floating whole behavior -->\n        <span class=\"nx-formfield__label-holder\">\n          <label\n            class=\"nx-formfield__label\"\n            [attr.aria-owns]=\"_control.id\"\n            [attr.for]=\"_control.id\">\n            <ng-container *ngIf=\"!_labelChild\">\n              {{ label }}\n            </ng-container>\n            <ng-content select=\"nx-formfield-label\"></ng-content>\n          </label>\n        </span>\n      </div>\n\n      <div class=\"nx-formfield__suffix\" *ngIf=\"_suffixChildren.length\">\n          <ng-content select=\"[nxFormfieldSuffix]\"></ng-content>\n      </div>\n    </div>\n\n    <!-- Appendix is similar to a suffix but visibly outside of the input  -->\n    <div class=\"nx-formfield__appendix\" *ngIf=\"_appendixChildren.length\">\n      <ng-content select=\"[nxFormfieldAppendix]\"></ng-content>\n    </div>\n  </div>\n\n  <!-- Space to render the hints below the textfield -->\n  <div class=\"nx-formfield__hints\" *ngIf=\"_hintChildren.length\">\n      <ng-content select=\"[nxFormfieldHint]\"></ng-content>\n  </div>\n\n  <!-- In case we got some additional information we render them below the given input -->\n  <div class=\"nx-formfield__messages\" [ngSwitch]=\"getDisplayedMessage()\">\n    <div *ngSwitchCase=\"'error'\">\n      <ng-content select=\"[nxFormfieldError]\"></ng-content>\n    </div>\n\n    <div *ngSwitchCase=\"'hint'\">\n      <ng-content select=\"[nxFormfieldNote]\"></ng-content>\n    </div>\n  </div>\n</div>\n\n\n",
                host: {
                    '[class.nx-formfield]': 'true',
                    '[class.is-disabled]': 'this._control.disabled',
                    '[class.is-readonly]': 'this._control.readonly',
                    '[class.is-filled]': 'this._control.empty === false',
                    '[class.is-focused]': 'this._control.focused',
                    '[class.is-floating]': 'this.shouldLabelFloat',
                    '[class.has-error]': 'this._control.errorState',
                    '[class.has-outline]': 'this.appearance === "outline"'
                },
                changeDetection: ChangeDetectionStrategy.OnPush,
                encapsulation: ViewEncapsulation.None,
                styles: [".nx-formfield{display:block;font-size:20px;color:#414141;text-align:left}.nx-formfield__wrapper{padding-bottom:24px}.nx-formfield__input{position:relative;line-height:28px;letter-spacing:.2px;flex:auto;min-width:0}.nx-formfield__label-holder{position:absolute;left:0;box-sizing:content-box;width:100%;height:100%;pointer-events:none;z-index:10;top:-16px;padding-top:16px}.nx-formfield__label{color:inherit;display:block;position:absolute;left:0;pointer-events:none;width:100%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;-webkit-transform-origin:0 0;transform-origin:0 0;transition:transform .15s ease-out,font-size .15s ease-out,-webkit-transform .15s ease-out;font-weight:300;-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%;letter-spacing:.2px}.nx-formfield__flexfield{display:inline-flex;align-items:flex-end;width:100%;border-bottom:1px solid currentColor;margin-top:16px;padding-bottom:3px}.nx-formfield__row{display:flex;align-items:center;width:100%}.nx-formfield__input textarea[nxInput]{vertical-align:bottom}.nx-formfield__appendix,.nx-formfield__prefix,.nx-formfield__suffix{flex:none;white-space:nowrap;color:#414141;font-weight:600;letter-spacing:.2px}.nx-formfield__appendix nx-icon.nx-icon--auto,.nx-formfield__prefix nx-icon.nx-icon--auto,.nx-formfield__suffix nx-icon.nx-icon--auto{font-size:24px;font-weight:400}.nx-formfield__appendix nx-icon,.nx-formfield__prefix nx-icon,.nx-formfield__suffix nx-icon{display:block;color:#006192;height:24px}.nx-formfield__appendix nx-password-toggle nx-icon,.nx-formfield__prefix nx-password-toggle nx-icon,.nx-formfield__suffix nx-password-toggle nx-icon{color:#414141}.nx-formfield__prefix,.nx-formfield__suffix{line-height:28px;height:28px;display:inline-flex;align-items:center}.nx-formfield__appendix{margin-left:8px;margin-top:16px;display:flex;border-bottom:1px solid transparent;padding-bottom:3px;align-items:center}.nx-formfield__prefix{margin-right:8px}.nx-formfield__suffix{margin-left:8px}.nx-formfield__hints{text-align:right;color:#414141;font-size:12px;line-height:16px;letter-spacing:.5px;padding-top:8px}.nx-formfield__messages{margin-top:4px}.nx-formfield.is-focused .nx-formfield__label{text-overflow:ellipsis;font-weight:600;font-size:12px}.nx-formfield.is-focused:not(.nx-formfield--negative):not(.has-error){color:#006192}.nx-formfield.is-focused:not(.nx-formfield--negative):not(.has-error) .nx-formfield__label{color:#414141}.nx-formfield.is-focused:not(.nx-formfield--negative):not(.has-error) .nx-formfield__flexfield{border-bottom-color:#007ab3}.nx-formfield.is-focused:not(.nx-formfield--negative):not(.has-error).nx-formfield--negative{color:#fff}.nx-formfield.is-focused:not(.nx-formfield--negative):not(.has-error) nx-password-toggle nx-icon{color:#007ab3}.nx-formfield.is-focused:not(.nx-formfield--negative).has-outline .nx-formfield__flexfield{border-color:#006192;box-shadow:0 0 0 2px #009de6}.nx-formfield.is-focused:not(.nx-formfield--negative).has-outline.has-error .nx-formfield__flexfield{border-color:#dc3149}.nx-formfield.is-focused:not(.nx-formfield--negative).has-outline nx-password-toggle nx-icon{color:#007ab3}.nx-formfield.has-outline{font-size:16px;line-height:24px}.nx-formfield.has-outline .nx-formfield__flexfield{border:1px solid #767676;border-radius:4px;margin-top:28px;min-height:40px;align-items:center;padding-bottom:0}.nx-formfield.has-outline .nx-formfield__label{padding-left:7px;padding-right:7px}.nx-formfield.has-outline .nx-formfield__input{margin-top:0;padding-bottom:0;line-height:38px}.nx-formfield.has-outline .nx-formfield__input input[nxInput],.nx-formfield.has-outline .nx-formfield__input textarea[nxInput]{font-weight:400}.nx-formfield.has-outline .nx-formfield__input textarea[nxInput]{min-height:38px;line-height:24px;padding:7px}.nx-formfield.has-outline .nx-formfield__input input[nxInput]{padding-right:7px;padding-left:7px;line-height:normal}.nx-formfield.has-outline nx-dropdown .nx-dropdown__icon{display:flex}.nx-formfield.has-outline nx-dropdown .nx-dropdown__container{padding-left:7px;height:38px}.nx-formfield.has-outline nx-datepicker-toggle .nx-datepicker-toggle-button{padding:0}.nx-formfield.has-outline .nx-formfield__appendix,.nx-formfield.has-outline .nx-formfield__prefix,.nx-formfield.has-outline .nx-formfield__suffix{font-weight:400}.nx-formfield.has-outline .nx-formfield__prefix,.nx-formfield.has-outline .nx-formfield__suffix{height:38px;line-height:38px}.nx-formfield.has-outline .nx-formfield__prefix{margin-left:7px;margin-right:0}.nx-formfield.has-outline .nx-formfield__suffix{margin-right:7px;margin-left:0}.nx-formfield.has-outline .nx-formfield__appendix{margin-left:8px;display:flex;margin-top:28px;border-top:1px solid transparent;border-bottom:1px solid transparent;padding-bottom:0}.nx-formfield.has-outline .nx-formfield__hints{text-align:left;font-size:16px}.nx-formfield.has-outline.is-readonly .nx-formfield__flexfield{border-color:#c2c2c2;background-color:#f5f5f5}.nx-formfield.is-floating .nx-formfield__label{-webkit-transform:translateY(-22px);transform:translateY(-22px);font-size:12px;font-weight:600;letter-spacing:.5px}.nx-formfield.is-floating.has-outline .nx-formfield__label-holder{top:-24px;padding-top:24px}.nx-formfield.is-floating.has-outline .nx-formfield__label{padding-top:0;-webkit-transform:translateX(-8px) translateY(-29px);transform:translateX(-8px) translateY(-29px);font-size:16px;line-height:24px}.nx-formfield.is-floating.has-outline .nx-formfield__prefix~.nx-formfield__input .nx-formfield__label{-webkit-transform:translateY(-29px);transform:translateY(-29px)}.nx-formfield.has-error{color:#dc3149}.nx-formfield.has-error .nx-formfield__label{font-weight:700}.nx-formfield.has-error.is-floating .nx-formfield__label{color:#414141;font-weight:600}.nx-formfield.has-error.has-outline{color:#414141}.nx-formfield.has-error.has-outline .nx-formfield__flexfield{border-color:#dc3149}.nx-formfield.has-error nx-password-toggle nx-icon{color:#dc3149}.nx-formfield.is-disabled{color:#c2c2c2;cursor:not-allowed;-webkit-text-fill-color:#c2c2c2}.nx-formfield.is-disabled .nx-formfield__hints{color:inherit}.nx-formfield.is-disabled .nx-formfield__flexfield{border-bottom-color:#c2c2c2}.nx-formfield.is-disabled.has-outline .nx-formfield__flexfield{border-color:#c2c2c2}.nx-formfield--negative{color:#fff}.nx-formfield--negative .nx-formfield__hints{color:inherit}.nx-formfield--negative.has-outline .nx-formfield__flexfield{border-color:#fff}.nx-formfield--negative nx-password-toggle nx-icon{color:#fff}", ".c-input{text-align:inherit;font-size:inherit;background:0 0;color:inherit;border:none;outline:0;padding:0;margin:0;width:100%;max-width:100%;line-height:28px;height:28px}.c-input::-ms-clear{display:none}.c-input::-webkit-search-cancel-button,.c-input::-webkit-search-decoration,.c-input::-webkit-search-results-button,.c-input::-webkit-search-results-decoration{display:none;-webkit-appearance:none}textarea.c-input{min-height:28px;height:auto;font-family:inherit}.c-input.is-focused{border:none;outline:0;box-shadow:none}.c-input.is-filled{font-weight:600}.c-input.is-disabled{cursor:not-allowed}textarea.nx-input-element{resize:vertical;overflow:auto}.c-input:invalid,.c-input:required{box-shadow:none}"]
            }] }
];
/** @nocollapse */
NxFormfieldComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [FORMFIELD_DEFAULT_OPTIONS,] }] }
];
NxFormfieldComponent.propDecorators = {
    _control: [{ type: ContentChild, args: [NxFormfieldControl,] }],
    label: [{ type: Input, args: ['nxLabel',] }],
    _labelChild: [{ type: ContentChild, args: [NxFormfieldLabelDirective,] }],
    _hintChildren: [{ type: ContentChildren, args: [NxFormfieldHintDirective,] }],
    _noteChildren: [{ type: ContentChildren, args: [NxFormfieldNoteDirective,] }],
    _errorChildren: [{ type: ContentChildren, args: [NxFormfieldErrorDirective,] }],
    _suffixChildren: [{ type: ContentChildren, args: [NxFormfieldSuffixDirective,] }],
    _prefixChildren: [{ type: ContentChildren, args: [NxFormfieldPrefixDirective,] }],
    _appendixChildren: [{ type: ContentChildren, args: [NxFormfieldAppendixDirective,] }],
    _connectionContainerRef: [{ type: ViewChild, args: ['connectionContainer',] }],
    floatLabel: [{ type: Input, args: ['nxFloatLabel',] }],
    styles: [{ type: Input, args: ['nxStyle',] }],
    appearance: [{ type: Input }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    NxFormfieldComponent.prototype._styles;
    /**
     * @type {?}
     * @private
     */
    NxFormfieldComponent.prototype._subscriptions;
    /** @type {?} */
    NxFormfieldComponent.prototype._control;
    /**
     * Sets the label which will act as a floating label.
     * In addition, the component uses input and label to properly support accessibility.
     * @type {?}
     */
    NxFormfieldComponent.prototype.label;
    /** @type {?} */
    NxFormfieldComponent.prototype._labelChild;
    /** @type {?} */
    NxFormfieldComponent.prototype._hintChildren;
    /** @type {?} */
    NxFormfieldComponent.prototype._noteChildren;
    /** @type {?} */
    NxFormfieldComponent.prototype._errorChildren;
    /** @type {?} */
    NxFormfieldComponent.prototype._suffixChildren;
    /** @type {?} */
    NxFormfieldComponent.prototype._prefixChildren;
    /** @type {?} */
    NxFormfieldComponent.prototype._appendixChildren;
    /** @type {?} */
    NxFormfieldComponent.prototype._connectionContainerRef;
    /**
     * @type {?}
     * @private
     */
    NxFormfieldComponent.prototype._floatLabel;
    /**
     * @type {?}
     * @private
     */
    NxFormfieldComponent.prototype._appearance;
    /**
     * \@docs-private
     * @type {?}
     */
    NxFormfieldComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    NxFormfieldComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    NxFormfieldComponent.prototype._changeDetectorRef;
    /**
     * @type {?}
     * @private
     */
    NxFormfieldComponent.prototype._defaultOptions;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybWZpZWxkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGxpYW56L25neC1uZGJ4L2Zvcm1maWVsZC8iLCJzb3VyY2VzIjpbImZvcm1maWVsZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUUsT0FBTyxFQUlMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixlQUFlLEVBQ2YsVUFBVSxFQUNWLEtBQUssRUFDTCxTQUFTLEVBQ1QsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFM0QsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDNUQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDNUQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDOUQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFekQsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDaEUsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDaEUsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDcEUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sbUJBQW1CLENBQUM7O01BRXhELFNBQVMsR0FBRztJQUNoQixVQUFVLEVBQUUsd0JBQXdCO0NBQ3JDOzs7Ozs7QUFNRCw2Q0FNQzs7Ozs7O0lBSkMsNkNBQTRCOzs7OztJ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RiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZpZXdDaGlsZCwgSW5qZWN0aW9uVG9rZW4sIEluamVjdCwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEFmdGVyQ29udGVudENoZWNrZWQsXG4gIEFmdGVyQ29udGVudEluaXQsXG4gIE9uRGVzdHJveSxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFbGVtZW50UmVmLFxuICBJbnB1dCxcbiAgUXVlcnlMaXN0LFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgUmVuZGVyZXIyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgc3RhcnRXaXRoIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgZ2V0Q2xhc3NOYW1lTGlzdCB9IGZyb20gJ0BhbGxpYW56L25neC1uZGJ4L3V0aWxzJztcblxuaW1wb3J0IHsgTnhGb3JtZmllbGRIaW50RGlyZWN0aXZlIH0gZnJvbSAnLi9oaW50LmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBOeEZvcm1maWVsZE5vdGVEaXJlY3RpdmUgfSBmcm9tICcuL25vdGUuZGlyZWN0aXZlJztcbmltcG9ydCB7IE54Rm9ybWZpZWxkRXJyb3JEaXJlY3RpdmUgfSBmcm9tICcuL2Vycm9yLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBOeEZvcm1maWVsZENvbnRyb2wgfSBmcm9tICcuL2Zvcm1maWVsZC1jb250cm9sJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTnhGb3JtZmllbGRTdWZmaXhEaXJlY3RpdmUgfSBmcm9tICcuL3N1ZmZpeC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgTnhGb3JtZmllbGRQcmVmaXhEaXJlY3RpdmUgfSBmcm9tICcuL3ByZWZpeC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgTnhGb3JtZmllbGRBcHBlbmRpeERpcmVjdGl2ZSB9IGZyb20gJy4vYXBwZW5kaXguZGlyZWN0aXZlJztcbmltcG9ydCB7IE54Rm9ybWZpZWxkTGFiZWxEaXJlY3RpdmUgfSBmcm9tICcuL2xhYmVsLmRpcmVjdGl2ZSc7XG5cbmNvbnN0IE5YX1NUWUxFUyA9IHtcbiAgJ25lZ2F0aXZlJzogJ254LWZvcm1maWVsZC0tbmVnYXRpdmUnXG59O1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIGRlZmF1bHQgb3B0aW9ucyBmb3IgdGhlIGZvcm0gZmllbGQgdGhhdCBjYW4gYmUgY29uZmlndXJlZFxuICogdXNpbmcgdGhlIGBGT1JNRklFTERfREVGQVVMVF9PUFRJT05TYCBpbmplY3Rpb24gdG9rZW4uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRm9ybWZpZWxkRGVmYXVsdE9wdGlvbnMge1xuICAvKiogU2V0cyB0aGUgZGVmYXVsdCBhcHBlYXJhbmNlLiAob3B0aW9uYWwpICovXG4gIGFwcGVhcmFuY2U/OiBBcHBlYXJhbmNlVHlwZTtcblxuICAvKiogU2V0cyB0aGUgZGVmYXVsdCBmbG9hdCBsYWJlbCB0eXBlLiAob3B0aW9uYWwpICovXG4gIG54RmxvYXRMYWJlbD86IEZsb2F0TGFiZWxUeXBlO1xufVxuXG5leHBvcnQgY29uc3QgRk9STUZJRUxEX0RFRkFVTFRfT1BUSU9OUyA9XG4gIG5ldyBJbmplY3Rpb25Ub2tlbjxGb3JtZmllbGREZWZhdWx0T3B0aW9ucz4oJ0ZPUk1GSUVMRF9ERUZBVUxUX09QVElPTlMnKTtcblxuLyoqIFR5cGUgZm9yIHRoZSBhdmFpbGFibGUgZmxvYXRMYWJlbCB2YWx1ZXMuICovXG5leHBvcnQgdHlwZSBGbG9hdExhYmVsVHlwZSA9ICdhbHdheXMnIHwgJ2F1dG8nO1xuXG4vKiogVHlwZSBmb3IgdGhlIGFwcGVhcmFuY2Ugb2YgdGhlIGZvcm1maWVsZC4gKi9cbmV4cG9ydCB0eXBlIEFwcGVhcmFuY2VUeXBlID0gJ291dGxpbmUnIHwgJ2F1dG8nO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdueC1mb3JtZmllbGQnLFxuICB0ZW1wbGF0ZVVybDogJ2Zvcm1maWVsZC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogW1xuICAgICdmb3JtZmllbGQuc2NzcycsXG4gICAgJy4uL2lucHV0L2lucHV0LnNjc3MnXG4gIF0sXG4gIGhvc3Q6IHtcbiAgICAnW2NsYXNzLm54LWZvcm1maWVsZF0nOiAndHJ1ZScsXG4gICAgJ1tjbGFzcy5pcy1kaXNhYmxlZF0nOiAndGhpcy5fY29udHJvbC5kaXNhYmxlZCcsXG4gICAgJ1tjbGFzcy5pcy1yZWFkb25seV0nOiAndGhpcy5fY29udHJvbC5yZWFkb25seScsXG4gICAgJ1tjbGFzcy5pcy1maWxsZWRdJzogJ3RoaXMuX2NvbnRyb2wuZW1wdHkgPT09IGZhbHNlJyxcbiAgICAnW2NsYXNzLmlzLWZvY3VzZWRdJzogJ3RoaXMuX2NvbnRyb2wuZm9jdXNlZCcsXG4gICAgJ1tjbGFzcy5pcy1mbG9hdGluZ10nOiAndGhpcy5zaG91bGRMYWJlbEZsb2F0JyxcbiAgICAnW2NsYXNzLmhhcy1lcnJvcl0nOiAndGhpcy5fY29udHJvbC5lcnJvclN0YXRlJyxcbiAgICAnW2NsYXNzLmhhcy1vdXRsaW5lXSc6ICd0aGlzLmFwcGVhcmFuY2UgPT09IFwib3V0bGluZVwiJ1xuICB9LFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBOeEZvcm1maWVsZENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIEFmdGVyQ29udGVudENoZWNrZWQsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgX3N0eWxlczogc3RyaW5nID0gJyc7XG4gIHByaXZhdGUgX3N1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XG5cbiAgQENvbnRlbnRDaGlsZChOeEZvcm1maWVsZENvbnRyb2wpIF9jb250cm9sOiBOeEZvcm1maWVsZENvbnRyb2w8YW55PjtcblxuICAvKipcbiAgICogU2V0cyB0aGUgbGFiZWwgd2hpY2ggd2lsbCBhY3QgYXMgYSBmbG9hdGluZyBsYWJlbC5cbiAgICogSW4gYWRkaXRpb24sIHRoZSBjb21wb25lbnQgdXNlcyBpbnB1dCBhbmQgbGFiZWwgdG8gcHJvcGVybHkgc3VwcG9ydCBhY2Nlc3NpYmlsaXR5LlxuICAgKi9cbiAgQElucHV0KCdueExhYmVsJykgbGFiZWw6IHN0cmluZztcblxuICBAQ29udGVudENoaWxkKE54Rm9ybWZpZWxkTGFiZWxEaXJlY3RpdmUpIF9sYWJlbENoaWxkOiBOeEZvcm1maWVsZExhYmVsRGlyZWN0aXZlO1xuICBAQ29udGVudENoaWxkcmVuKE54Rm9ybWZpZWxkSGludERpcmVjdGl2ZSkgX2hpbnRDaGlsZHJlbjogUXVlcnlMaXN0PE54Rm9ybWZpZWxkSGludERpcmVjdGl2ZT47XG4gIEBDb250ZW50Q2hpbGRyZW4oTnhGb3JtZmllbGROb3RlRGlyZWN0aXZlKSBfbm90ZUNoaWxkcmVuOiBRdWVyeUxpc3Q8TnhGb3JtZmllbGROb3RlRGlyZWN0aXZlPjtcbiAgQENvbnRlbnRDaGlsZHJlbihOeEZvcm1maWVsZEVycm9yRGlyZWN0aXZlKSBfZXJyb3JDaGlsZHJlbjogUXVlcnlMaXN0PE54Rm9ybWZpZWxkRXJyb3JEaXJlY3RpdmU+O1xuICBAQ29udGVudENoaWxkcmVuKE54Rm9ybWZpZWxkU3VmZml4RGlyZWN0aXZlKSBfc3VmZml4Q2hpbGRyZW46IFF1ZXJ5TGlzdDxOeEZvcm1maWVsZFN1ZmZpeERpcmVjdGl2ZT47XG4gIEBDb250ZW50Q2hpbGRyZW4oTnhGb3JtZmllbGRQcmVmaXhEaXJlY3RpdmUpIF9wcmVmaXhDaGlsZHJlbjogUXVlcnlMaXN0PE54Rm9ybWZpZWxkUHJlZml4RGlyZWN0aXZlPjtcbiAgQENvbnRlbnRDaGlsZHJlbihOeEZvcm1maWVsZEFwcGVuZGl4RGlyZWN0aXZlKSBfYXBwZW5kaXhDaGlsZHJlbjogUXVlcnlMaXN0PE54Rm9ybWZpZWxkQXBwZW5kaXhEaXJlY3RpdmU+O1xuXG4gIEBWaWV3Q2hpbGQoJ2Nvbm5lY3Rpb25Db250YWluZXInKSBfY29ubmVjdGlvbkNvbnRhaW5lclJlZjogRWxlbWVudFJlZjtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgbGFiZWwgc2hvdWxkIGZsb2F0IG9uY2UgdGhlIGlucHV0IGlzIGZvY3VzZWQgb3IgZmlsbGVkIChhdXRvLCBkZWZhdWx0KVxuICAgKiBvciBmb3JjZSBpdCB0byBhbHdheXMgZmxvYXQgd2l0aCBhIHZhbHVlIG9mIGFsd2F5cyB0byBzaW11bGF0ZSBhIG1vcmUgc3RhdGljIGZvcm0uXG4gICAqL1xuICBASW5wdXQoJ254RmxvYXRMYWJlbCcpXG4gIGdldCBmbG9hdExhYmVsKCk6IEZsb2F0TGFiZWxUeXBlIHtcbiAgICByZXR1cm4gdGhpcy5fZmxvYXRMYWJlbCB8fCAodGhpcy5fZGVmYXVsdE9wdGlvbnMgJiYgdGhpcy5fZGVmYXVsdE9wdGlvbnMubnhGbG9hdExhYmVsKSB8fCAnYXV0byc7XG4gIH1cbiAgc2V0IGZsb2F0TGFiZWwodmFsdWU6IEZsb2F0TGFiZWxUeXBlKSB7XG4gICAgaWYgKHZhbHVlICE9PSB0aGlzLl9mbG9hdExhYmVsKSB7XG4gICAgICB0aGlzLl9mbG9hdExhYmVsID0gdmFsdWUgfHwgJ2F1dG8nO1xuICAgICAgdGhpcy5fY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgX2Zsb2F0TGFiZWw6IEZsb2F0TGFiZWxUeXBlO1xuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBzdHlsaW5nIG9mIHRoZSBmb3JtZmllbGQuXG4gICAqIElmICduZWdhdGl2ZScsIGEgbmVnYXRpdmUgc2V0IG9mIHN0eWxpbmdzIGlzIHVzZWQuXG4gICAqL1xuICBASW5wdXQoJ254U3R5bGUnKVxuICBzZXQgc3R5bGVzKHZhbHVlOiBzdHJpbmcpIHtcblxuICAgIGlmICh0aGlzLl9zdHlsZXMgPT09IHZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY2xhc3NOYW1lcyA9IGdldENsYXNzTmFtZUxpc3QodmFsdWUsIE5YX1NUWUxFUyk7XG5cbiAgICBjbGFzc05hbWVzLmZvckVhY2goY2xhc3NTdHIgPT4ge1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgY2xhc3NTdHIpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fc3R5bGVzID0gdmFsdWU7XG4gIH1cblxuICBwcml2YXRlIF9hcHBlYXJhbmNlOiBBcHBlYXJhbmNlVHlwZTtcblxuICAvKipcbiAgICogKipOREJYIEV4cGVydCBvcHRpb24qKlxuICAgKlxuICAgKiBTZXRzIHRoZSBhcHBlYXJhbmNlIG9mIHRoZSBmb3JtZmllbGQuXG4gICAqL1xuICBASW5wdXQoKVxuICBzZXQgYXBwZWFyYW5jZSh2YWx1ZTogQXBwZWFyYW5jZVR5cGUpIHtcbiAgICBpZiAodGhpcy5fYXBwZWFyYW5jZSAhPT0gdmFsdWUpIHtcbiAgICAgIHRoaXMuX2FwcGVhcmFuY2UgPSB2YWx1ZTtcbiAgICAgIHRoaXMuX2NoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgfVxuICBnZXQgYXBwZWFyYW5jZSgpOiBBcHBlYXJhbmNlVHlwZSB7XG4gICAgcmV0dXJuIHRoaXMuX2FwcGVhcmFuY2UgfHwgKHRoaXMuX2RlZmF1bHRPcHRpb25zICYmIHRoaXMuX2RlZmF1bHRPcHRpb25zLmFwcGVhcmFuY2UpIHx8ICdhdXRvJztcbiAgfVxuXG4gIGdldCBfc2hvdWxkQWx3YXlzRmxvYXQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZmxvYXRMYWJlbCA9PT0gJ2Fsd2F5cyc7XG4gIH1cblxuICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICBwdWJsaWMgZ2V0IHNob3VsZExhYmVsRmxvYXQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICh0aGlzLl9jb250cm9sLnNob3VsZExhYmVsRmxvYXQgfHwgdGhpcy5fc2hvdWxkQWx3YXlzRmxvYXQpO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgICBwdWJsaWMgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJpdmF0ZSBfY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoRk9STUZJRUxEX0RFRkFVTFRfT1BUSU9OUykgcHJpdmF0ZSBfZGVmYXVsdE9wdGlvbnM6IEZvcm1maWVsZERlZmF1bHRPcHRpb25zXG4gICAgKSB7IH1cblxuICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICBwdWJsaWMgZ2V0IGNvbnRyb2woKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRyb2w7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgbGV0IHN1YnNjcmlwdGlvbjtcbiAgICBjb25zdCBzdWJzY3JpcHRpb25zID0gW107XG5cbiAgICB0aGlzLl92YWxpZGF0ZUNvbnRyb2xDaGlsZCgpO1xuXG4gICAgLy8gU3Vic2NyaWJlIHRvIGNoYW5nZXMgaW4gdGhlIGNoaWxkIGNvbnRyb2wgc3RhdGUgaW4gb3JkZXIgdG8gdXBkYXRlIHRoZSBmb3JtIGZpZWxkIFVJLlxuICAgIHN1YnNjcmlwdGlvbiA9IHRoaXMuX2NvbnRyb2wuc3RhdGVDaGFuZ2VzLnBpcGUoc3RhcnRXaXRoKG51bGwpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5fc3luY0Rlc2NyaWJlZEJ5SWRzKCk7XG4gICAgICB0aGlzLl9jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICB9KTtcblxuICAgIHN1YnNjcmlwdGlvbnMucHVzaChzdWJzY3JpcHRpb24pO1xuXG4gICAgLy8gUmUtdmFsaWRhdGUgd2hlbiB0aGUgbnVtYmVyIG9mIGhpbnRzIGNoYW5nZXMuXG4gICAgc3Vic2NyaXB0aW9uID0gdGhpcy5faGludENoaWxkcmVuLmNoYW5nZXMucGlwZShzdGFydFdpdGgobnVsbCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLl9jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICB9KTtcbiAgICBzdWJzY3JpcHRpb25zLnB1c2goc3Vic2NyaXB0aW9uKTtcblxuICAgIC8vIFVwZGF0ZSB0aGUgYXJpYS1kZXNjcmliZWQgYnkgd2hlbiB0aGUgbnVtYmVyIG9mIGVycm9ycyBjaGFuZ2VzLlxuICAgIHN1YnNjcmlwdGlvbiA9IHRoaXMuX2Vycm9yQ2hpbGRyZW4uY2hhbmdlcy5waXBlKHN0YXJ0V2l0aChudWxsKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMuX3N5bmNEZXNjcmliZWRCeUlkcygpO1xuICAgICAgdGhpcy5fY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgfSk7XG4gICAgc3Vic2NyaXB0aW9ucy5wdXNoKHN1YnNjcmlwdGlvbik7XG5cbiAgICB0aGlzLl9zdWJzY3JpcHRpb25zID0gc3Vic2NyaXB0aW9ucztcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50Q2hlY2tlZCgpIHtcbiAgICB0aGlzLl92YWxpZGF0ZUNvbnRyb2xDaGlsZCgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5fc3Vic2NyaXB0aW9ucy5mb3JFYWNoKChzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbikgPT4gc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCkpO1xuICB9XG5cbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgZ2V0RGlzcGxheWVkTWVzc2FnZSgpOiAnaGludCcgfCAnZXJyb3InIHtcbiAgICBpZiAodGhpcy5fY29udHJvbC5lcnJvclN0YXRlICYmIHRoaXMuX2Vycm9yQ2hpbGRyZW4gJiYgdGhpcy5fZXJyb3JDaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gJ2Vycm9yJztcbiAgICB9XG5cbiAgICByZXR1cm4gJ2hpbnQnO1xuICB9XG5cbiAgcHJpdmF0ZSBfc3luY0Rlc2NyaWJlZEJ5SWRzKCkge1xuICAgIGlmICh0aGlzLl9jb250cm9sKSB7XG4gICAgICBsZXQgaWRzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgaWRzID0gdGhpcy5fbm90ZUNoaWxkcmVuLm1hcChoaW50ID0+IGhpbnQuaWQpO1xuXG4gICAgICBpZiAodGhpcy5nZXREaXNwbGF5ZWRNZXNzYWdlKCkgPT09ICdoaW50Jykge1xuICAgICAgICBpZHMgPSBbLi4udGhpcy5faGludENoaWxkcmVuLm1hcChoaW50ID0+IGhpbnQuaWQpLCAuLi5pZHNdO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9lcnJvckNoaWxkcmVuKSB7XG4gICAgICAgIGlkcyA9IFsuLi50aGlzLl9lcnJvckNoaWxkcmVuLm1hcChlcnJvciA9PiBlcnJvci5pZCksIC4uLmlkc107XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2NvbnRyb2wuc2V0RGVzY3JpYmVkQnlJZHMoaWRzKTtcbiAgICB9XG4gIH1cblxuICAvLyBGYWlsIGlmIHRoZSByZXF1aXJlZCBjb250cm9sIGlzIG1pc3NpbmcuXG4gIHByb3RlY3RlZCBfdmFsaWRhdGVDb250cm9sQ2hpbGQoKSB7XG4gICAgaWYgKCF0aGlzLl9jb250cm9sKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Zvcm1maWVsZCBtdXN0IGNvbnRhaW4gYSBOeEZvcm1maWVsZENvbnRyb2wgbGlrZSBpbnB1dFtueElucHV0XSBvciBhIGN1c3RvbSBpbXBsZW1lbnRhdGlvbicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIGdldENvbm5lY3RlZE92ZXJsYXlPcmlnaW4oKTogRWxlbWVudFJlZiB7XG4gICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb25Db250YWluZXJSZWYgfHwgdGhpcy5lbGVtZW50UmVmO1xuICB9XG59XG4iXX0=