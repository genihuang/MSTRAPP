/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, Component, Input, ChangeDetectorRef, ElementRef, Self, Optional } from '@angular/core';
import { NgControl } from '@angular/forms';
import { NxCodeInputIntl } from './code-input-intl';
import { BACKSPACE, LEFT_ARROW, RIGHT_ARROW, SPACE } from '@angular/cdk/keycodes';
/** @type {?} */
var DEFAULT_INPUT_LENGTH = 6;
/** @type {?} */
var TAG_NAME_INPUT = 'INPUT';
/** @type {?} */
var AUTO_UPPERCASE = 'upper';
/** @type {?} */
var AUTO_LOWERCASE = 'lower';
/** @type {?} */
var INPUT_FIELD_GAP = 'nx-code-input--gap';
var NxCodeInputComponent = /** @class */ (function () {
    function NxCodeInputComponent(_changeDetectorRef, _el, _control, _intl) {
        this._changeDetectorRef = _changeDetectorRef;
        this._el = _el;
        this._control = _control;
        this._intl = _intl;
        this._codeLength = DEFAULT_INPUT_LENGTH;
        this._type = 'text';
        this._tabindex = 0;
        /**
         * The user input in array form
         */
        this._keyCode = new Array(DEFAULT_INPUT_LENGTH);
        this._focused = false;
        /**
         * \@docs-private
         */
        this.propagateChange = (/**
         * @param {?} _
         * @return {?}
         */
        function (_) {
        });
        /**
         * \@docs-private
         */
        this.propagateTouch = (/**
         * @param {?} _
         * @return {?}
         */
        function (_) {
        });
        if (this._control) {
            // Note: we provide the value accessor through here, instead of
            // the `providers` to avoid running into a circular import.
            this._control.valueAccessor = this;
        }
    }
    Object.defineProperty(NxCodeInputComponent.prototype, "codeLength", {
        get: /**
         * @return {?}
         */
        function () {
            return this._codeLength;
        },
        /** The length of the code input. Default: 6. */
        set: /**
         * The length of the code input. Default: 6.
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._codeLength = value;
            this.setInputLength();
            this._changeDetectorRef.markForCheck();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NxCodeInputComponent.prototype, "type", {
        get: /**
         * @return {?}
         */
        function () {
            return this._type;
        },
        /** The type of HTML input */
        set: /**
         * The type of HTML input
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._type = value;
            this._changeDetectorRef.markForCheck();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NxCodeInputComponent.prototype, "tabindex", {
        get: /**
         * @return {?}
         */
        function () {
            return this._tabindex;
        },
        /* Sets the the tabindex if code input */
        set: /* Sets the the tabindex if code input */
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._tabindex = value;
            this._changeDetectorRef.markForCheck();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NxCodeInputComponent.prototype, "convertTo", {
        get: /**
         * @return {?}
         */
        function () {
            return this._convertTo;
        },
        /** Whether the form should auto capitalize or lowercase. (Optional) */
        set: /**
         * Whether the form should auto capitalize or lowercase. (Optional)
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._convertTo = value;
            this._changeDetectorRef.markForCheck();
        },
        enumerable: true,
        configurable: true
    });
    /** Sets the length of the input fields. */
    /**
     * Sets the length of the input fields.
     * @return {?}
     */
    NxCodeInputComponent.prototype.setInputLength = /**
     * Sets the length of the input fields.
     * @return {?}
     */
    function () {
        if (this.codeLength) {
            this._keyCode = new Array(this.codeLength);
        }
        else {
            this._keyCode = new Array(DEFAULT_INPUT_LENGTH);
        }
    };
    /** Converts to upper or lowercase when enabled. */
    /**
     * Converts to upper or lowercase when enabled.
     * @param {?} value
     * @return {?}
     */
    NxCodeInputComponent.prototype._convertLetterSize = /**
     * Converts to upper or lowercase when enabled.
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value === 'ÃŸ') {
            return value;
        }
        if (typeof value === 'string') {
            if (this.convertTo === AUTO_UPPERCASE) {
                return value.toUpperCase();
            }
            else if (this.convertTo === AUTO_LOWERCASE) {
                return value.toLowerCase();
            }
            return value;
        }
    };
    /** Reacts to keydown event. */
    /**
     * Reacts to keydown event.
     * @param {?} event
     * @return {?}
     */
    NxCodeInputComponent.prototype._keydownAction = /**
     * Reacts to keydown event.
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var previousInputField = event.target.previousElementSibling;
        /** @type {?} */
        var nextInputField = event.target.nextElementSibling;
        switch (event.keyCode) {
            case SPACE:
                return false;
            case BACKSPACE:
                if (event.target.value === '') {
                    if (previousInputField && previousInputField.tagName === TAG_NAME_INPUT) {
                        previousInputField.focus();
                        previousInputField.select();
                    }
                }
                break;
            case LEFT_ARROW:
                if (previousInputField && previousInputField.tagName === TAG_NAME_INPUT) {
                    event.preventDefault();
                    previousInputField.focus();
                    previousInputField.select();
                }
                break;
            case RIGHT_ARROW:
                if (nextInputField && nextInputField.tagName === TAG_NAME_INPUT) {
                    nextInputField.focus();
                    nextInputField.select();
                }
                event.preventDefault();
                break;
            default:
                break;
        }
    };
    /** Selects the value on click of an input field. */
    /**
     * Selects the value on click of an input field.
     * @param {?} event
     * @return {?}
     */
    NxCodeInputComponent.prototype._selectText = /**
     * Selects the value on click of an input field.
     * @param {?} event
     * @return {?}
     */
    function (event) {
        event.target.select();
    };
    /** Automatically focuses and selects the next input on key input. */
    /**
     * Automatically focuses and selects the next input on key input.
     * @param {?} event
     * @return {?}
     */
    NxCodeInputComponent.prototype._selectNextInput = /**
     * Automatically focuses and selects the next input on key input.
     * @param {?} event
     * @return {?}
     */
    function (event) {
        event.target.value = this._convertLetterSize(event.target.value);
        this.propagateChange(this._keyCode.join(''));
        if (event.target.value) {
            /** @type {?} */
            var nextInputField = event.target.nextSibling;
            if (nextInputField !== null && nextInputField.tagName === TAG_NAME_INPUT) {
                nextInputField.focus();
                if (nextInputField.value !== '') {
                    nextInputField.select();
                }
            }
        }
    };
    /** Paste event to distribute content in input fields. */
    /**
     * Paste event to distribute content in input fields.
     * @param {?} event
     * @return {?}
     */
    NxCodeInputComponent.prototype._pasteClipboard = /**
     * Paste event to distribute content in input fields.
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var copiedText = '';
        if (event.clipboardData === undefined) {
            copiedText = ((/** @type {?} */ (window))).clipboardData.getData('text').replace(/ /g, '').split('');
        }
        else {
            copiedText = event.clipboardData.getData('text').replace(/ /g, '').split('');
        }
        /** @type {?} */
        var index = 0;
        /** @type {?} */
        var count = 0;
        for (var i = 0; i < this._el.nativeElement.children.length; i++) {
            if (event.srcElement === this._el.nativeElement.children.item(i)) {
                index = i;
            }
        }
        for (var i = index; i < this.codeLength; i++) {
            this._keyCode[i] = this._convertLetterSize(copiedText[count]);
            count++;
        }
        this.propagateChange(this._keyCode.join(''));
        if (index + copiedText.length < this.codeLength) {
            this._el.nativeElement.children.item(index + copiedText.length).focus();
            event.preventDefault();
        }
        else if (index + copiedText.length >= this.codeLength) {
            event.preventDefault();
        }
    };
    /** Triggers when an input field is blurred. */
    /**
     * Triggers when an input field is blurred.
     * @return {?}
     */
    NxCodeInputComponent.prototype._onBlur = /**
     * Triggers when an input field is blurred.
     * @return {?}
     */
    function () {
        var _this = this;
        this._focused = false;
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (!_this._focused) {
                _this.propagateTouch(_this._keyCode.join(''));
            }
            _this._changeDetectorRef.markForCheck();
        }));
    };
    /** Sets _focused state and makes valid. */
    /**
     * Sets _focused state and makes valid.
     * @return {?}
     */
    NxCodeInputComponent.prototype._setFocusState = /**
     * Sets _focused state and makes valid.
     * @return {?}
     */
    function () {
        this._focused = true;
    };
    /** Sets initial value, used by ControlValueAccessor. */
    /**
     * Sets initial value, used by ControlValueAccessor.
     * @param {?} value
     * @return {?}
     */
    NxCodeInputComponent.prototype.writeValue = /**
     * Sets initial value, used by ControlValueAccessor.
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value) {
            /** @type {?} */
            var valueAsArray = value.split('').slice(0, this.codeLength);
            for (var i = 0; i < this.codeLength; i++) {
                this._keyCode[i] = valueAsArray[i];
            }
        }
        else {
            this.setInputLength();
        }
        this._changeDetectorRef.markForCheck();
    };
    /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    NxCodeInputComponent.prototype._trackByKeyCode = /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    function (index, item) {
        return index;
    };
    /** Adds a gap to input fields when appropriate. */
    /**
     * Adds a gap to input fields when appropriate.
     * @param {?} index
     * @return {?}
     */
    NxCodeInputComponent.prototype._inputGap = /**
     * Adds a gap to input fields when appropriate.
     * @param {?} index
     * @return {?}
     */
    function (index) {
        switch (this.codeLength) {
            case 4:
            case 6:
            case 8:
                if (index === this.codeLength / 2) {
                    return INPUT_FIELD_GAP;
                }
                break;
            default:
                return;
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    NxCodeInputComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.propagateChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    NxCodeInputComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.propagateTouch = fn;
    };
    NxCodeInputComponent.decorators = [
        { type: Component, args: [{
                    selector: 'nx-code-input',
                    template: "<input type=\"text\"\n       class=\"nx-code-input__field\"\n       maxlength=\"1\"\n       *ngFor=\"let key of _keyCode; index as i; trackBy: _trackByKeyCode;\"\n       [(ngModel)]=\"_keyCode[i]\"\n       [ngClass]=\"_inputGap(i)\"\n       [attr.aria-label]=\"_intl.inputFieldAriaLabel\"\n       [attr.type]=\"type\"\n       (input)=\"_selectNextInput($event)\"\n       (paste)=\"_pasteClipboard($event)\"\n       (blur)=\"_onBlur()\"\n       (focus)=\"_setFocusState()\"\n       (click)=\"_selectText($event)\"\n       (keydown)=\"_keydownAction($event)\"\n       (ngModelChange)=\"_keyCode[i]=_convertLetterSize($event)\"\n/>\n",
                    host: {
                        '[class.nx-code-input]': 'true',
                        '[class.has-error]': '_control ? _control.invalid && _control.touched : false',
                        '[attr.tabindex]': 'tabindex'
                    },
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: [":host{display:block}.nx-code-input__field{margin:0 4px;text-align:center;font-weight:600;font-size:26px;line-height:32px;border:0;outline:0;caret-color:#006192;border-bottom:1px solid #414141;width:32px;color:#414141;border-radius:0;padding:0}.nx-code-input__field:focus{margin-bottom:-1px;color:#007ab3;border-bottom:2px solid currentColor}.nx-code-input--gap{margin-left:24px}:host.has-error .nx-code-input__field{margin-bottom:-1px;font-weight:700;color:#dc3149;border-bottom:2px solid #dc3149}"]
                }] }
    ];
    /** @nocollapse */
    NxCodeInputComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: ElementRef },
        { type: NgControl, decorators: [{ type: Self }, { type: Optional }] },
        { type: NxCodeInputIntl }
    ]; };
    NxCodeInputComponent.propDecorators = {
        codeLength: [{ type: Input, args: ['length',] }],
        type: [{ type: Input }],
        tabindex: [{ type: Input }],
        convertTo: [{ type: Input, args: ['nxConvertTo',] }]
    };
    return NxCodeInputComponent;
}());
export { NxCodeInputComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NxCodeInputComponent.prototype._codeLength;
    /**
     * @type {?}
     * @private
     */
    NxCodeInputComponent.prototype._type;
    /**
     * @type {?}
     * @private
     */
    NxCodeInputComponent.prototype._tabindex;
    /**
     * @type {?}
     * @private
     */
    NxCodeInputComponent.prototype._convertTo;
    /**
     * The user input in array form
     * @type {?}
     */
    NxCodeInputComponent.prototype._keyCode;
    /**
     * @type {?}
     * @private
     */
    NxCodeInputComponent.prototype._focused;
    /**
     * \@docs-private
     * @type {?}
     */
    NxCodeInputComponent.prototype.propagateChange;
    /**
     * \@docs-private
     * @type {?}
     */
    NxCodeInputComponent.prototype.propagateTouch;
    /**
     * @type {?}
     * @private
     */
    NxCodeInputComponent.prototype._changeDetectorRef;
    /**
     * @type {?}
     * @private
     */
    NxCodeInputComponent.prototype._el;
    /** @type {?} */
    NxCodeInputComponent.prototype._control;
    /** @type {?} */
    NxCodeInputComponent.prototype._intl;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZS1pbnB1dC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxsaWFuei9uZ3gtbmRieC9jb2RlLWlucHV0LyIsInNvdXJjZXMiOlsiY29kZS1pbnB1dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULEtBQUssRUFDTCxpQkFBaUIsRUFDakIsVUFBVSxFQUNWLElBQUksRUFDSixRQUFRLEVBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUF3QixTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxNQUFNLHVCQUF1QixDQUFDOztJQUU1RSxvQkFBb0IsR0FBRyxDQUFDOztJQUN4QixjQUFjLEdBQUcsT0FBTzs7SUFDeEIsY0FBYyxHQUFHLE9BQU87O0lBQ3hCLGNBQWMsR0FBRyxPQUFPOztJQUN4QixlQUFlLEdBQUcsb0JBQW9CO0FBRzVDO0lBK0RFLDhCQUNVLGtCQUFxQyxFQUNyQyxHQUFlLEVBQ0ksUUFBbUIsRUFDdkMsS0FBc0I7UUFIckIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFtQjtRQUNyQyxRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQ0ksYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUN2QyxVQUFLLEdBQUwsS0FBSyxDQUFpQjtRQTNDdkIsZ0JBQVcsR0FBVyxvQkFBb0IsQ0FBQztRQVczQyxVQUFLLEdBQVcsTUFBTSxDQUFDO1FBV3ZCLGNBQVMsR0FBVyxDQUFDLENBQUM7Ozs7UUFjOUIsYUFBUSxHQUFhLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDN0MsYUFBUSxHQUFZLEtBQUssQ0FBQzs7OztRQTBMbEMsb0JBQWU7Ozs7UUFBRyxVQUFDLENB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dEIsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7SUFDNUIsQ0FBQzs7Ozs7SUFFRCxnREFBaUI7Ozs7SUFBakIsVUFBa0IsRUFBTztRQUN2QixJQUFJLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztJQUMzQixDQUFDOztnQkFwUUYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxlQUFlO29CQUN6Qixrb0JBQXdDO29CQUl4QyxJQUFJLEVBQUU7d0JBQ0osdUJBQXVCLEVBQUUsTUFBTTt3QkFDL0IsbUJBQW1CLEVBQUUseURBQXlEO3dCQUM5RSxpQkFBaUIsRUFBRSxVQUFVO3FCQUM5QjtvQkFDRCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7aUJBQ2hEOzs7O2dCQTVCQyxpQkFBaUI7Z0JBQ2pCLFVBQVU7Z0JBSW1CLFNBQVMsdUJBNkVuQyxJQUFJLFlBQUksUUFBUTtnQkE1RVosZUFBZTs7OzZCQXlCckIsS0FBSyxTQUFDLFFBQVE7dUJBWWQsS0FBSzsyQkFXTCxLQUFLOzRCQVdMLEtBQUssU0FBQyxhQUFhOztJQW9OdEIsMkJBQUM7Q0FBQSxBQXJRRCxJQXFRQztTQXhQWSxvQkFBb0I7Ozs7OztJQVcvQiwyQ0FBbUQ7Ozs7O0lBV25ELHFDQUErQjs7Ozs7SUFXL0IseUNBQThCOzs7OztJQVc5QiwwQ0FBdUM7Ozs7O0lBR3ZDLHdDQUFxRDs7Ozs7SUFDckQsd0NBQWtDOzs7OztJQTBMbEMsK0NBQ0M7Ozs7O0lBR0QsOENBQ0M7Ozs7O0lBNUxDLGtEQUE2Qzs7Ozs7SUFDN0MsbUNBQXVCOztJQUN2Qix3Q0FBOEM7O0lBQzlDLHFDQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIElucHV0LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgRWxlbWVudFJlZixcbiAgU2VsZixcbiAgT3B0aW9uYWxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTmdDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTnhDb2RlSW5wdXRJbnRsIH0gZnJvbSAnLi9jb2RlLWlucHV0LWludGwnO1xuaW1wb3J0IHsgQkFDS1NQQUNFLCBMRUZUX0FSUk9XLCBSSUdIVF9BUlJPVywgU1BBQ0UgfSBmcm9tICdAYW5ndWxhci9jZGsva2V5Y29kZXMnO1xuXG5jb25zdCBERUZBVUxUX0lOUFVUX0xFTkdUSCA9IDY7XG5jb25zdCBUQUdfTkFNRV9JTlBVVCA9ICdJTlBVVCc7XG5jb25zdCBBVVRPX1VQUEVSQ0FTRSA9ICd1cHBlcic7XG5jb25zdCBBVVRPX0xPV0VSQ0FTRSA9ICdsb3dlcic7XG5jb25zdCBJTlBVVF9GSUVMRF9HQVAgPSAnbngtY29kZS1pbnB1dC0tZ2FwJztcbmV4cG9ydCB0eXBlIE54Q29udmVyc2lvblR5cGVzID0gJ2xvd2VyJyB8ICd1cHBlcic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ254LWNvZGUtaW5wdXQnLFxuICB0ZW1wbGF0ZVVybDogJ2NvZGUtaW5wdXQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFtcbiAgICAnY29kZS1pbnB1dC5zY3NzJ1xuICBdLFxuICBob3N0OiB7XG4gICAgJ1tjbGFzcy5ueC1jb2RlLWlucHV0XSc6ICd0cnVlJyxcbiAgICAnW2NsYXNzLmhhcy1lcnJvcl0nOiAnX2NvbnRyb2wgPyBfY29udHJvbC5pbnZhbGlkICYmIF9jb250cm9sLnRvdWNoZWQgOiBmYWxzZScsXG4gICAgJ1thdHRyLnRhYmluZGV4XSc6ICd0YWJpbmRleCdcbiAgfSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgTnhDb2RlSW5wdXRDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG4gIC8qKiBUaGUgbGVuZ3RoIG9mIHRoZSBjb2RlIGlucHV0LiBEZWZhdWx0OiA2LiAqL1xuICBASW5wdXQoJ2xlbmd0aCcpXG4gIHNldCBjb2RlTGVuZ3RoKHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLl9jb2RlTGVuZ3RoID0gdmFsdWU7XG4gICAgdGhpcy5zZXRJbnB1dExlbmd0aCgpO1xuICAgIHRoaXMuX2NoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICB9XG4gIGdldCBjb2RlTGVuZ3RoKCkge1xuICAgIHJldHVybiB0aGlzLl9jb2RlTGVuZ3RoO1xuICB9XG4gIHByaXZhdGUgX2NvZGVMZW5ndGg6IG51bWJlciA9IERFRkFVTFRfSU5QVVRfTEVOR1RIO1xuXG4gIC8qKiBUaGUgdHlwZSBvZiBIVE1MIGlucHV0ICovXG4gIEBJbnB1dCgpXG4gIHNldCB0eXBlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLl90eXBlID0gdmFsdWU7XG4gICAgdGhpcy5fY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gIH1cbiAgZ2V0IHR5cGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3R5cGU7XG4gIH1cbiAgcHJpdmF0ZSBfdHlwZTogc3RyaW5nID0gJ3RleHQnO1xuXG4gIC8qIFNldHMgdGhlIHRoZSB0YWJpbmRleCBpZiBjb2RlIGlucHV0ICovXG4gIEBJbnB1dCgpXG4gIHNldCB0YWJpbmRleCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5fdGFiaW5kZXggPSB2YWx1ZTtcbiAgICB0aGlzLl9jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuICBnZXQgdGFiaW5kZXgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fdGFiaW5kZXg7XG4gIH1cbiAgcHJpdmF0ZSBfdGFiaW5kZXg6IG51bWJlciA9IDA7XG5cbiAgLyoqIFdoZXRoZXIgdGhlIGZvcm0gc2hvdWxkIGF1dG8gY2FwaXRhbGl6ZSBvciBsb3dlcmNhc2UuIChPcHRpb25hbCkgKi9cbiAgQElucHV0KCdueENvbnZlcnRUbycpXG4gIHNldCBjb252ZXJ0VG8odmFsdWU6IE54Q29udmVyc2lvblR5cGVzKSB7XG4gICAgdGhpcy5fY29udmVydFRvID0gdmFsdWU7XG4gICAgdGhpcy5fY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gIH1cbiAgZ2V0IGNvbnZlcnRUbygpIHtcbiAgICByZXR1cm4gdGhpcy5fY29udmVydFRvO1xuICB9XG4gIHByaXZhdGUgX2NvbnZlcnRUbz86IE54Q29udmVyc2lvblR5cGVzO1xuXG4gIC8qKiBUaGUgdXNlciBpbnB1dCBpbiBhcnJheSBmb3JtICovXG4gIF9rZXlDb2RlOiBzdHJpbmdbXSA9IG5ldyBBcnJheShERUZBVUxUX0lOUFVUX0xFTkdUSCk7XG4gIHByaXZhdGUgX2ZvY3VzZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF9jaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBfZWw6IEVsZW1lbnRSZWYsXG4gICAgQFNlbGYoKSBAT3B0aW9uYWwoKSBwdWJsaWMgX2NvbnRyb2w6IE5nQ29udHJvbCxcbiAgICBwdWJsaWMgX2ludGw6IE54Q29kZUlucHV0SW50bCkge1xuICAgIGlmICh0aGlzLl9jb250cm9sKSB7XG4gICAgICAvLyBOb3RlOiB3ZSBwcm92aWRlIHRoZSB2YWx1ZSBhY2Nlc3NvciB0aHJvdWdoIGhlcmUsIGluc3RlYWQgb2ZcbiAgICAgIC8vIHRoZSBgcHJvdmlkZXJzYCB0byBhdm9pZCBydW5uaW5nIGludG8gYSBjaXJjdWxhciBpbXBvcnQuXG4gICAgICB0aGlzLl9jb250cm9sLnZhbHVlQWNjZXNzb3IgPSB0aGlzO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBTZXRzIHRoZSBsZW5ndGggb2YgdGhlIGlucHV0IGZpZWxkcy4gKi9cbiAgc2V0SW5wdXRMZW5ndGgoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29kZUxlbmd0aCkge1xuICAgICAgdGhpcy5fa2V5Q29kZSA9IG5ldyBBcnJheSh0aGlzLmNvZGVMZW5ndGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9rZXlDb2RlID0gbmV3IEFycmF5KERFRkFVTFRfSU5QVVRfTEVOR1RIKTtcbiAgICB9XG4gIH1cblxuICAvKiogQ29udmVydHMgdG8gdXBwZXIgb3IgbG93ZXJjYXNlIHdoZW4gZW5hYmxlZC4gKi9cbiAgX2NvbnZlcnRMZXR0ZXJTaXplKHZhbHVlOiBhbnkpOiBzdHJpbmcge1xuICAgIGlmICh2YWx1ZSA9PT0gJ8OfJykge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAodGhpcy5jb252ZXJ0VG8gPT09IEFVVE9fVVBQRVJDQVNFKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZS50b1VwcGVyQ2FzZSgpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbnZlcnRUbyA9PT0gQVVUT19MT1dFUkNBU0UpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICAvKiogUmVhY3RzIHRvIGtleWRvd24gZXZlbnQuICovXG4gIF9rZXlkb3duQWN0aW9uKGV2ZW50KTogdm9pZCB8IGZhbHNlIHtcbiAgICBjb25zdCBwcmV2aW91c0lucHV0RmllbGQgPSBldmVudC50YXJnZXQucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICBjb25zdCBuZXh0SW5wdXRGaWVsZCA9IGV2ZW50LnRhcmdldC5uZXh0RWxlbWVudFNpYmxpbmc7XG5cbiAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgIGNhc2UgU1BBQ0U6XG4gICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgY2FzZSBCQUNLU1BBQ0U6XG4gICAgICAgIGlmIChldmVudC50YXJnZXQudmFsdWUgPT09ICcnKSB7XG4gICAgICAgICAgaWYgKHByZXZpb3VzSW5wdXRGaWVsZCAmJiBwcmV2aW91c0lucHV0RmllbGQudGFnTmFtZSA9PT0gVEFHX05BTUVfSU5QVVQpIHtcbiAgICAgICAgICAgIHByZXZpb3VzSW5wdXRGaWVsZC5mb2N1cygpO1xuICAgICAgICAgICAgcHJldmlvdXNJbnB1dEZpZWxkLnNlbGVjdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBMRUZUX0FSUk9XOlxuICAgICAgICBpZiAocHJldmlvdXNJbnB1dEZpZWxkICYmIHByZXZpb3VzSW5wdXRGaWVsZC50YWdOYW1lID09PSBUQUdfTkFNRV9JTlBVVCkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgcHJldmlvdXNJbnB1dEZpZWxkLmZvY3VzKCk7XG4gICAgICAgICAgcHJldmlvdXNJbnB1dEZpZWxkLnNlbGVjdCgpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFJJR0hUX0FSUk9XOlxuICAgICAgICBpZiAobmV4dElucHV0RmllbGQgJiYgbmV4dElucHV0RmllbGQudGFnTmFtZSA9PT0gVEFHX05BTUVfSU5QVVQpIHtcbiAgICAgICAgICBuZXh0SW5wdXRGaWVsZC5mb2N1cygpO1xuICAgICAgICAgIG5leHRJbnB1dEZpZWxkLnNlbGVjdCgpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICAvKiogU2VsZWN0cyB0aGUgdmFsdWUgb24gY2xpY2sgb2YgYW4gaW5wdXQgZmllbGQuICovXG4gIF9zZWxlY3RUZXh0KGV2ZW50KTogdm9pZCB7XG4gICAgZXZlbnQudGFyZ2V0LnNlbGVjdCgpO1xuICB9XG5cbiAgLyoqIEF1dG9tYXRpY2FsbHkgZm9jdXNlcyBhbmQgc2VsZWN0cyB0aGUgbmV4dCBpbnB1dCBvbiBrZXkgaW5wdXQuICovXG4gIF9zZWxlY3ROZXh0SW5wdXQoZXZlbnQpOiB2b2lkIHtcbiAgICBldmVudC50YXJnZXQudmFsdWUgPSB0aGlzLl9jb252ZXJ0TGV0dGVyU2l6ZShldmVudC50YXJnZXQudmFsdWUpO1xuICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlKHRoaXMuX2tleUNvZGUuam9pbignJykpO1xuXG4gICAgaWYgKGV2ZW50LnRhcmdldC52YWx1ZSkge1xuICAgICAgY29uc3QgbmV4dElucHV0RmllbGQgPSBldmVudC50YXJnZXQubmV4dFNpYmxpbmc7XG5cbiAgICAgIGlmIChuZXh0SW5wdXRGaWVsZCAhPT0gbnVsbCAmJiBuZXh0SW5wdXRGaWVsZC50YWdOYW1lID09PSBUQUdfTkFNRV9JTlBVVCkge1xuICAgICAgICBuZXh0SW5wdXRGaWVsZC5mb2N1cygpO1xuICAgICAgICBpZiAobmV4dElucHV0RmllbGQudmFsdWUgIT09ICcnKSB7XG4gICAgICAgICAgbmV4dElucHV0RmllbGQuc2VsZWN0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKiogUGFzdGUgZXZlbnQgdG8gZGlzdHJpYnV0ZSBjb250ZW50IGluIGlucHV0IGZpZWxkcy4gKi9cbiAgX3Bhc3RlQ2xpcGJvYXJkKGV2ZW50KTogdm9pZCB7XG4gICAgbGV0IGNvcGllZFRleHQgPSAnJztcbiAgICBpZiAoZXZlbnQuY2xpcGJvYXJkRGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb3BpZWRUZXh0ID0gKDxhbnk+d2luZG93KS5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQnKS5yZXBsYWNlKC8gL2csICcnKS5zcGxpdCgnJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvcGllZFRleHQgPSBldmVudC5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQnKS5yZXBsYWNlKC8gL2csICcnKS5zcGxpdCgnJyk7XG4gICAgfVxuXG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBsZXQgY291bnQgPSAwO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9lbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoZXZlbnQuc3JjRWxlbWVudCA9PT0gdGhpcy5fZWwubmF0aXZlRWxlbWVudC5jaGlsZHJlbi5pdGVtKGkpKSB7XG4gICAgICAgIGluZGV4ID0gaTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gaW5kZXg7IGkgPCB0aGlzLmNvZGVMZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5fa2V5Q29kZVtpXSA9IHRoaXMuX2NvbnZlcnRMZXR0ZXJTaXplKGNvcGllZFRleHRbY291bnRdKTtcbiAgICAgIGNvdW50Kys7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UodGhpcy5fa2V5Q29kZS5qb2luKCcnKSk7XG5cbiAgICBpZiAoaW5kZXggKyBjb3BpZWRUZXh0Lmxlbmd0aCA8IHRoaXMuY29kZUxlbmd0aCkge1xuICAgICAgdGhpcy5fZWwubmF0aXZlRWxlbWVudC5jaGlsZHJlbi5pdGVtKGluZGV4ICsgY29waWVkVGV4dC5sZW5ndGgpLmZvY3VzKCk7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0gZWxzZSBpZiAoaW5kZXggKyBjb3BpZWRUZXh0Lmxlbmd0aCA+PSB0aGlzLmNvZGVMZW5ndGgpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqIFRyaWdnZXJzIHdoZW4gYW4gaW5wdXQgZmllbGQgaXMgYmx1cnJlZC4gKi9cbiAgX29uQmx1cigpOiB2b2lkIHtcbiAgICB0aGlzLl9mb2N1c2VkID0gZmFsc2U7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuX2ZvY3VzZWQpIHtcbiAgICAgICAgdGhpcy5wcm9wYWdhdGVUb3VjaCh0aGlzLl9rZXlDb2RlLmpvaW4oJycpKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2NoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqIFNldHMgX2ZvY3VzZWQgc3RhdGUgYW5kIG1ha2VzIHZhbGlkLiAqL1xuICBfc2V0Rm9jdXNTdGF0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLl9mb2N1c2VkID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKiBTZXRzIGluaXRpYWwgdmFsdWUsIHVzZWQgYnkgQ29udHJvbFZhbHVlQWNjZXNzb3IuICovXG4gIHdyaXRlVmFsdWUodmFsdWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgY29uc3QgdmFsdWVBc0FycmF5ID0gdmFsdWUuc3BsaXQoJycpLnNsaWNlKDAsIHRoaXMuY29kZUxlbmd0aCk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jb2RlTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdGhpcy5fa2V5Q29kZVtpXSA9IHZhbHVlQXNBcnJheVtpXTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRJbnB1dExlbmd0aCgpO1xuICAgIH1cblxuICAgIHRoaXMuX2NoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgX3RyYWNrQnlLZXlDb2RlKGluZGV4OiBudW1iZXIsIGl0ZW06IHN0cmluZyk6IG51bWJlciB7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgLyoqIEFkZHMgYSBnYXAgdG8gaW5wdXQgZmllbGRzIHdoZW4gYXBwcm9wcmlhdGUuICovXG4gIF9pbnB1dEdhcChpbmRleCk6IHN0cmluZyB7XG4gICAgc3dpdGNoICh0aGlzLmNvZGVMZW5ndGgpIHtcbiAgICAgIGNhc2UgNDpcbiAgICAgIGNhc2UgNjpcbiAgICAgIGNhc2UgODpcbiAgICAgICAgaWYgKGluZGV4ID09PSB0aGlzLmNvZGVMZW5ndGggLyAyKSB7XG4gICAgICAgICAgcmV0dXJuIElOUFVUX0ZJRUxEX0dBUDtcbiAgICAgICAgfVxuXG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIHByb3BhZ2F0ZUNoYW5nZSA9IChfOiBhbnkpID0+IHtcbiAgfVxuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIHByb3BhZ2F0ZVRvdWNoID0gKF86IGFueSkgPT4ge1xuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KSB7XG4gICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpIHtcbiAgICB0aGlzLnByb3BhZ2F0ZVRvdWNoID0gZm47XG4gIH1cbn1cblxuXG4iXX0=