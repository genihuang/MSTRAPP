/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NxFormfieldControl, NxFormfieldErrorDirective } from '@allianz/ngx-ndbx/formfield';
import { getFontShorthand } from '@allianz/ngx-ndbx/utils';
import { Overlay } from '@angular/cdk/overlay';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ContentChildren, ElementRef, HostBinding, Input, QueryList, Renderer2, ViewChild } from '@angular/core';
import { startWith } from 'rxjs/operators';
import { Subject, Subscription } from 'rxjs';
import { NxPopoverTriggerDirective } from '@allianz/ngx-ndbx/popover';
import { NxDropdownComponent } from '@allianz/ngx-ndbx/dropdown';
var NxWordComponent = /** @class */ (function () {
    function NxWordComponent(elementRef, _changeDetectorRef, _renderer, _overlay) {
        this.elementRef = elementRef;
        this._changeDetectorRef = _changeDetectorRef;
        this._renderer = _renderer;
        this._overlay = _overlay;
        this.subscription = Subscription.EMPTY;
        this.subscriptionValues = Subscription.EMPTY;
        /**
         * \@docs-private
         */
        this.hasErrors = false;
        /**
         * \@docs-private
         */
        this.inputChanges = new Subject();
        /**
         * \@docs-private
         */
        this.currentTextWidth = 0;
        // this will apply different min-widths to our component through our styles
        /**
         * Provide a hint for a minimal width. The actual size will be determined for inputs for each change.
         */
        this.size = 'regular';
    }
    /**
     * @return {?}
     */
    NxWordComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._validateControlChild();
        this.subscription = this._control.stateChanges.pipe(startWith(null)).subscribe((/**
         * @return {?}
         */
        function () {
            _this.hasErrors = _this._control.errorState;
            _this._changeDetectorRef.markForCheck();
        }));
        // if we have a ngcontrol available stick to its valueChanges subject
        if (this._control.ngControl) {
            this.subscriptionValues = this._control.ngControl.valueChanges.subscribe((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                _this.updateCurrentTextWidth();
                _this.inputChanges.next();
            }));
            // in any other case it is a bre input and input changes are signaled through simple state changes
        }
        else {
            this.subscriptionValues = this._control.stateChanges.subscribe((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                _this.updateCurrentTextWidth();
                _this.inputChanges.next();
            }));
        }
        this._control.setAriaLabel(this.label);
    };
    /**
     * @return {?}
     */
    NxWordComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.subscription.unsubscribe();
    };
    /**
      @docs-private
      Calculate the width of the full text given by the input,
      that value is bound to this component so it can grow.
  
      The involved input is known to have a width of 100% an will fit the additional space given
      which completes the auto growing behavior.
    */
    /**
     * \@docs-private
     * Calculate the width of the full text given by the input,
     * that value is bound to this component so it can grow.
     * The involved input is known to have a width of 100% an will fit the additional space given
     * which completes the auto growing behavior.
     * @return {?}
     */
    NxWordComponent.prototype.updateCurrentTextWidth = /**
     * \@docs-private
     * Calculate the width of the full text given by the input,
     * that value is bound to this component so it can grow.
     * The involved input is known to have a width of 100% an will fit the additional space given
     * which completes the auto growing behavior.
     * @return {?}
     */
    function () {
        // provide the canvas only lazy
        if (!this.measureCanvas) {
            this.measureCanvas = this._renderer.createElement('canvas');
        }
        /** @type {?} */
        var ctx = this.measureCanvas.getContext('2d');
        /** @type {?} */
        var inputRef = this._control.elementRef;
        /** @type {?} */
        var styles = window.getComputedStyle(inputRef.nativeElement);
        ctx.font = getFontShorthand(styles);
        /** @type {?} */
        var metrics = ctx.measureText(this._control.value);
        // add 1px (cursor width) to prevent jumping of the text on blur.
        /** @type {?} */
        var newWidth = metrics.width + parseInt(styles.paddingRight, 10) + parseInt(styles.paddingLeft, 10) + 1;
        // This should be injected via @Host to get an exact reference to NxNaturalLanguageFormComponent
        // Works as promised as long as there is not other tag around the word. Not expected but possible.
        /** @type {?} */
        var parent = this.elementRef.nativeElement.parentElement;
        /** @type {?} */
        var parentMeasurement = parent.getBoundingClientRect();
        // Limit to own given minimal width
        this.currentTextWidth = Math.max(parseInt(styles.minWidth, 10), newWidth);
        // Limit to container width
        this.currentTextWidth = Math.min(this.currentTextWidth, parentMeasurement.width);
        this._popover.updatePosition();
    };
    /** @docs-private */
    /**
     * \@docs-private
     * @return {?}
     */
    NxWordComponent.prototype.repositionError = /**
     * \@docs-private
     * @return {?}
     */
    function () {
        if (this._popover) {
            this._popover.updatePosition();
        }
    };
    // Fail if the required control is missing.
    // Fail if the required control is missing.
    /**
     * @protected
     * @return {?}
     */
    NxWordComponent.prototype._validateControlChild = 
    // Fail if the required control is missing.
    /**
     * @protected
     * @return {?}
     */
    function () {
        if (!this._control) {
            throw new Error('NxWordComponent requires an NxFormfieldControl compatible input.');
        }
    };
    /** @docs-private */
    /**
     * \@docs-private
     * @return {?}
     */
    NxWordComponent.prototype.getConnectedOverlayOrigin = /**
     * \@docs-private
     * @return {?}
     */
    function () {
        return this.elementRef;
    };
    Object.defineProperty(NxWordComponent.prototype, "isFocused", {
        /** @docs-private */
        get: /**
         * \@docs-private
         * @return {?}
         */
        function () {
            return this._control.focused;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NxWordComponent.prototype, "isFilled", {
        /** @docs-private */
        get: /**
         * \@docs-private
         * @return {?}
         */
        function () {
            return !this._control.empty;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NxWordComponent.prototype, "hasDropdown", {
        /** @docs-private */
        get: /**
         * \@docs-private
         * @return {?}
         */
        function () {
            return Boolean(this._dropdown);
        },
        enumerable: true,
        configurable: true
    });
    NxWordComponent.decorators = [
        { type: Component, args: [{
                    selector: 'nx-word',
                    template: "<div\n  class=\"nx-word__input-wrapper\"\n  [nxPopoverTriggerFor]=\"popoverHover\"\n  nxPopoverTrigger='manual'\n  nxPopoverCloseable=\"false\"\n  nxPopoverDirection=\"top\"\n  [nxPopoverShow]=\"hasErrors && _errorChildren.length > 0\">\n\n  <!-- We only allow formfield controls here -->\n  <div *ngIf=\"!hasDropdown\" class=\"nx-word__inner-wrapper\">\n    <ng-content select=\"[nxInput]\"></ng-content>\n  </div>\n  <ng-content select=\"nx-dropdown\"></ng-content>\n</div>\n\n<nx-popover #popoverHover>\n  <ng-content select=\"[nxError]\"></ng-content>\n</nx-popover>\n",
                    host: {
                        '[class.size-short]': 'size == "short"',
                        '[class.size-regular]': 'size == "regular"',
                        '[class.size-long]': 'size == "long"',
                        '[class.has-error]': 'hasErrors',
                        '[class.is-focused]': 'isFocused',
                        '[class.is-filled]': 'isFilled',
                        '[class.has-dropdown]': 'hasDropdown',
                    },
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: [":host{display:inline-block;position:relative;font-weight:400;text-align:center;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;width:100%}:host .nx-word__inner-wrapper{border-bottom:2px solid #d9d9d9}:host.size-short{min-width:80px}:host.size-regular{min-width:152px}:host.size-long{min-width:360px}@media (max-width:991px){:host.size-long{min-width:280px}}@media (max-width:703px){:host.size-long{min-width:248px}}:host ::ng-deep .c-input{display:inline-block;text-align:inherit;font-size:inherit;line-height:inherit;background:0 0;color:inherit;border:none;outline:0;margin:0;width:100%;max-width:100%;height:auto;box-shadow:none;padding:0 8px}:host ::ng-deep .c-input.is-focused{outline:0;box-shadow:none;border-bottom-width:2px}:host ::ng-deep .c-input.is-filled,:host ::ng-deep .c-input.is-focused{color:#006192;font-weight:400}:host ::ng-deep .c-input.is-disabled{cursor:not-allowed}:host ::ng-deep .c-input::-ms-clear{display:none}:host ::ng-deep nx-dropdown{position:relative;border-bottom:2px solid #d9d9d9}:host ::ng-deep nx-dropdown .nx-dropdown__container{font-size:inherit;margin-bottom:-2px}:host ::ng-deep nx-dropdown.is-filled{border-color:#007ab3;color:#006192}:host ::ng-deep nx-dropdown .nx-dropdown__icon{line-height:inherit}:host ::ng-deep .nx-word__input-wrapper{width:100%}:host(.is-filled) .nx-word__inner-wrapper,:host(.is-focused) .nx-word__inner-wrapper{border-color:#007ab3}:host(.has-error) .nx-word__inner-wrapper{border-color:#dc3149}:host.has-error ::ng-deep nx-dropdown{color:#dc3149;border-color:#dc3149}:host.has-error ::ng-deep .c-input.has-error{color:#dc3149}:host-context(.is-negative) ::ng-deep .nx-dropdown,:host-context(.is-negative) ::ng-deep nx-dropdown,:host-context(.is-negative) ::ng-deep nx-dropdown.is-filled{border-color:#fff;color:#fff}:host-context(.is-negative) ::ng-deep .c-input{color:#fff}:host-context(.is-negative) .nx-word__inner-wrapper{border-color:#fff}.nx-word__inner-wrapper{height:52px}@media (max-width:991px){:host ::ng-deep nx-dropdown .nx-dropdown__container{font-size:26px}.nx-word__inner-wrapper{height:36px}}:host-context(.nx-natural-language-form--small) .nx-word__inner-wrapper{height:36px}:host-context(.nx-natural-language-form--small) ::ng-deep nx-dropdown .nx-dropdown__container{margin-bottom:2px}"]
                }] }
    ];
    /** @nocollapse */
    NxWordComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: Renderer2 },
        { type: Overlay }
    ]; };
    NxWordComponent.propDecorators = {
        _control: [{ type: ContentChild, args: [NxFormfieldControl,] }],
        _errorChildren: [{ type: ContentChildren, args: [NxFormfieldErrorDirective,] }],
        _popover: [{ type: ViewChild, args: [NxPopoverTriggerDirective,] }],
        _dropdown: [{ type: ContentChild, args: [NxDropdownComponent,] }],
        currentTextWidth: [{ type: HostBinding, args: ['style.width.px',] }],
        size: [{ type: Input, args: ['nxSize',] }],
        label: [{ type: Input, args: ['nxLabel',] }]
    };
    return NxWordComponent;
}());
export { NxWordComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype.subscription;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype.subscriptionValues;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.hasErrors;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype.measureCanvas;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.inputChanges;
    /** @type {?} */
    NxWordComponent.prototype._control;
    /** @type {?} */
    NxWordComponent.prototype._errorChildren;
    /** @type {?} */
    NxWordComponent.prototype._popover;
    /** @type {?} */
    NxWordComponent.prototype._dropdown;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.currentTextWidth;
    /**
     * Provide a hint for a minimal width. The actual size will be determined for inputs for each change.
     * @type {?}
     */
    NxWordComponent.prototype.size;
    /**
     * A word doesn't have a set place to show labels.
     * In order to be accessible, you have to provide a label with this property.
     * It will be attached to the given input through `aria-label`.
     * @type {?}
     */
    NxWordComponent.prototype.label;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._changeDetectorRef;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._overlay;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29yZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxsaWFuei9uZ3gtbmRieC8iLCJzb3VyY2VzIjpbIm5hdHVyYWwtbGFuZ3VhZ2UtZm9ybS93b3JkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLHlCQUF5QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDNUYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDM0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9DLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxZQUFZLEVBQ1osZUFBZSxFQUNmLFVBQVUsRUFDVixXQUFXLEVBQ1gsS0FBSyxFQUVMLFNBQVMsRUFDVCxTQUFTLEVBQ1QsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsT0FBTyxFQUFJLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUvQyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUtqRTtJQW9ERSx5QkFFUyxVQUFzQixFQUNyQixrQkFBcUMsRUFDckMsU0FBb0IsRUFDcEIsUUFBaUI7UUFIbEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUNyQix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW1CO1FBQ3JDLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDcEIsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQXJDbkIsaUJBQVksR0FBaUIsWUFBWSxDQUFDLEtBQUssQ0FBQztRQUNoRCx1QkFBa0IsR0FBaUIsWUFBWSxDQUFDLEtBQUssQ0FBQzs7OztRQUd2RCxjQUFTLEdB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QkFBaUI7d0JBQ3ZDLHNCQUFzQixFQUFFLG1CQUFtQjt3QkFDM0MsbUJBQW1CLEVBQUUsZ0JBQWdCO3dCQUNyQyxtQkFBbUIsRUFBRSxXQUFXO3dCQUNoQyxvQkFBb0IsRUFBRSxXQUFXO3dCQUNqQyxtQkFBbUIsRUFBRSxVQUFVO3dCQUMvQixzQkFBc0IsRUFBRSxhQUFhO3FCQUV0QztvQkFDRCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7aUJBQ2hEOzs7O2dCQWxDQyxVQUFVO2dCQUpWLGlCQUFpQjtnQkFTakIsU0FBUztnQkFiRixPQUFPOzs7MkJBd0RiLFlBQVksU0FBQyxrQkFBa0I7aUNBQy9CLGVBQWUsU0FBQyx5QkFBeUI7MkJBQ3pDLFNBQVMsU0FBQyx5QkFBeUI7NEJBQ25DLFlBQVksU0FBQyxtQkFBbUI7bUNBR2hDLFdBQVcsU0FBQyxnQkFBZ0I7dUJBTTVCLEtBQUssU0FBQyxRQUFRO3dCQU9kLEtBQUssU0FBQyxTQUFTOztJQThHbEIsc0JBQUM7Q0FBQSxBQWhLRCxJQWdLQztTQTdJWSxlQUFlOzs7Ozs7SUFDMUIsdUNBQXdEOzs7OztJQUN4RCw2Q0FBOEQ7Ozs7O0lBRzlELG9DQUFrQzs7Ozs7SUFFbEMsd0NBQXlDOzs7OztJQUd6Qyx1Q0FBa0M7O0lBRWxDLG1DQUFvRTs7SUFDcEUseUNBQWlHOztJQUNqRyxtQ0FBMEU7O0lBQzFFLG9DQUFrRTs7Ozs7SUFHbEUsMkNBQzZCOzs7OztJQUs3QiwrQkFBeUM7Ozs7Ozs7SUFPekMsZ0NBQWdDOzs7OztJQUk5QixxQ0FBNkI7Ozs7O0lBQzdCLDZDQUE2Qzs7Ozs7SUFDN0Msb0NBQTRCOzs7OztJQUM1QixtQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOeEZvcm1maWVsZENvbnRyb2wsIE54Rm9ybWZpZWxkRXJyb3JEaXJlY3RpdmUgfSBmcm9tICdAYWxsaWFuei9uZ3gtbmRieC9mb3JtZmllbGQnO1xuaW1wb3J0IHsgZ2V0Rm9udFNob3J0aGFuZCB9IGZyb20gJ0BhbGxpYW56L25neC1uZGJ4L3V0aWxzJztcbmltcG9ydCB7IE92ZXJsYXkgfSBmcm9tICdAYW5ndWxhci9jZGsvb3ZlcmxheSc7XG5pbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkLFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEVsZW1lbnRSZWYsXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBRdWVyeUxpc3QsXG4gIFJlbmRlcmVyMixcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgc3RhcnRXaXRoIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgU3ViamVjdCAsICBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgTnhQb3BvdmVyVHJpZ2dlckRpcmVjdGl2ZSB9IGZyb20gJ0BhbGxpYW56L25neC1uZGJ4L3BvcG92ZXInO1xuaW1wb3J0IHsgTnhEcm9wZG93bkNvbXBvbmVudCB9IGZyb20gJ0BhbGxpYW56L25neC1uZGJ4L2Ryb3Bkb3duJztcblxuLyoqIFR5cGUgdG8gZGV0ZXJtaW5lIHRoZSBtaW5pbWFsIHdpZHRoIG9mIGEgd29yZC4gKi9cbmV4cG9ydCB0eXBlIFNJWkVTID0gJ3JlZ3VsYXInIHwgJ3Nob3J0JyB8ICdsb25nJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbngtd29yZCcsXG4gIHRlbXBsYXRlVXJsOiAnd29yZC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogW1xuICAgICd3b3JkLmNvbXBvbmVudC5zY3NzJ1xuICBdLFxuICBob3N0OiB7XG4gICAgJ1tjbGFzcy5zaXplLXNob3J0XSc6ICdzaXplID09IFwic2hvcnRcIicsXG4gICAgJ1tjbGFzcy5zaXplLXJlZ3VsYXJdJzogJ3NpemUgPT0gXCJyZWd1bGFyXCInLFxuICAgICdbY2xhc3Muc2l6ZS1sb25nXSc6ICdzaXplID09IFwibG9uZ1wiJyxcbiAgICAnW2NsYXNzLmhhcy1lcnJvcl0nOiAnaGFzRXJyb3JzJyxcbiAgICAnW2NsYXNzLmlzLWZvY3VzZWRdJzogJ2lzRm9jdXNlZCcsXG4gICAgJ1tjbGFzcy5pcy1maWxsZWRdJzogJ2lzRmlsbGVkJyxcbiAgICAnW2NsYXNzLmhhcy1kcm9wZG93bl0nOiAnaGFzRHJvcGRvd24nLFxuXG4gIH0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcblxuZXhwb3J0IGNsYXNzIE54V29yZENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBTdWJzY3JpcHRpb24uRU1QVFk7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uVmFsdWVzOiBTdWJzY3JpcHRpb24gPSBTdWJzY3JpcHRpb24uRU1QVFk7XG5cbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgcHVibGljIGhhc0Vycm9yczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgbWVhc3VyZUNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XG5cbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgaW5wdXRDaGFuZ2VzID0gbmV3IFN1YmplY3Q8YW55PigpO1xuXG4gIEBDb250ZW50Q2hpbGQoTnhGb3JtZmllbGRDb250cm9sKSBfY29udHJvbDogTnhGb3JtZmllbGRDb250cm9sPGFueT47XG4gIEBDb250ZW50Q2hpbGRyZW4oTnhGb3JtZmllbGRFcnJvckRpcmVjdGl2ZSkgX2Vycm9yQ2hpbGRyZW46IFF1ZXJ5TGlzdDxOeEZvcm1maWVsZEVycm9yRGlyZWN0aXZlPjtcbiAgQFZpZXdDaGlsZChOeFBvcG92ZXJUcmlnZ2VyRGlyZWN0aXZlKSBfcG9wb3ZlcjogTnhQb3BvdmVyVHJpZ2dlckRpcmVjdGl2ZTtcbiAgQENvbnRlbnRDaGlsZChOeERyb3Bkb3duQ29tcG9uZW50KSBfZHJvcGRvd246IE54RHJvcGRvd25Db21wb25lbnQ7XG5cbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgQEhvc3RCaW5kaW5nKCdzdHlsZS53aWR0aC5weCcpXG4gIGN1cnJlbnRUZXh0V2lkdGg6IG51bWJlciA9IDA7XG5cblxuICAvLyB0aGlzIHdpbGwgYXBwbHkgZGlmZmVyZW50IG1pbi13aWR0aHMgdG8gb3VyIGNvbXBvbmVudCB0aHJvdWdoIG91ciBzdHlsZXNcbiAgLyoqIFByb3ZpZGUgYSBoaW50IGZvciBhIG1pbmltYWwgd2lkdGguIFRoZSBhY3R1YWwgc2l6ZSB3aWxsIGJlIGRldGVybWluZWQgZm9yIGlucHV0cyBmb3IgZWFjaCBjaGFuZ2UuICovXG4gIEBJbnB1dCgnbnhTaXplJykgc2l6ZTogU0laRVMgPSAncmVndWxhcic7XG5cbiAgLyoqXG4gICAqIEEgd29yZCBkb2Vzbid0IGhhdmUgYSBzZXQgcGxhY2UgdG8gc2hvdyBsYWJlbHMuXG4gICAqIEluIG9yZGVyIHRvIGJlIGFjY2Vzc2libGUsIHlvdSBoYXZlIHRvIHByb3ZpZGUgYSBsYWJlbCB3aXRoIHRoaXMgcHJvcGVydHkuXG4gICAqIEl0IHdpbGwgYmUgYXR0YWNoZWQgdG8gdGhlIGdpdmVuIGlucHV0IHRocm91Z2ggYGFyaWEtbGFiZWxgLlxuICAgKi9cbiAgQElucHV0KCdueExhYmVsJykgbGFiZWw6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihcbiAgICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICAgIHB1YmxpYyBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgX2NoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgX292ZXJsYXk6IE92ZXJsYXlcbiAgKSB7IH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5fdmFsaWRhdGVDb250cm9sQ2hpbGQoKTtcblxuICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gdGhpcy5fY29udHJvbC5zdGF0ZUNoYW5nZXMucGlwZShzdGFydFdpdGgobnVsbCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmhhc0Vycm9ycyA9IHRoaXMuX2NvbnRyb2wuZXJyb3JTdGF0ZTtcbiAgICAgIHRoaXMuX2NoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgIH0pO1xuXG4gICAgLy8gaWYgd2UgaGF2ZSBhIG5nY29udHJvbCBhdmFpbGFibGUgc3RpY2sgdG8gaXRzIHZhbHVlQ2hhbmdlcyBzdWJqZWN0XG4gICAgaWYgKHRoaXMuX2NvbnRyb2wubmdDb250cm9sKSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvblZhbHVlcyA9IHRoaXMuX2NvbnRyb2wubmdDb250cm9sLnZhbHVlQ2hhbmdlcy5zdWJzY3JpYmUodmFsdWUgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZUN1cnJlbnRUZXh0V2lkdGgoKTtcbiAgICAgICAgdGhpcy5pbnB1dENoYW5nZXMubmV4dCgpO1xuICAgICAgfSk7XG4gICAgLy8gaW4gYW55IG90aGVyIGNhc2UgaXQgaXMgYSBicmUgaW5wdXQgYW5kIGlucHV0IGNoYW5nZXMgYXJlIHNpZ25hbGVkIHRocm91Z2ggc2ltcGxlIHN0YXRlIGNoYW5nZXNcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb25WYWx1ZXMgPSB0aGlzLl9jb250cm9sLnN0YXRlQ2hhbmdlcy5zdWJzY3JpYmUodmFsdWUgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZUN1cnJlbnRUZXh0V2lkdGgoKTtcbiAgICAgICAgdGhpcy5pbnB1dENoYW5nZXMubmV4dCgpO1xuICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICB0aGlzLl9jb250cm9sLnNldEFyaWFMYWJlbCh0aGlzLmxhYmVsKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICAvKipcbiAgICBAZG9jcy1wcml2YXRlXG4gICAgQ2FsY3VsYXRlIHRoZSB3aWR0aCBvZiB0aGUgZnVsbCB0ZXh0IGdpdmVuIGJ5IHRoZSBpbnB1dCxcbiAgICB0aGF0IHZhbHVlIGlzIGJvdW5kIHRvIHRoaXMgY29tcG9uZW50IHNvIGl0IGNhbiBncm93LlxuXG4gICAgVGhlIGludm9sdmVkIGlucHV0IGlzIGtub3duIHRvIGhhdmUgYSB3aWR0aCBvZiAxMDAlIGFuIHdpbGwgZml0IHRoZSBhZGRpdGlvbmFsIHNwYWNlIGdpdmVuXG4gICAgd2hpY2ggY29tcGxldGVzIHRoZSBhdXRvIGdyb3dpbmcgYmVoYXZpb3IuXG4gICovXG4gIHVwZGF0ZUN1cnJlbnRUZXh0V2lkdGgoKSB7XG4gICAgLy8gcHJvdmlkZSB0aGUgY2FudmFzIG9ubHkgbGF6eVxuICAgIGlmICghdGhpcy5tZWFzdXJlQ2FudmFzKSB7XG4gICAgICB0aGlzLm1lYXN1cmVDYW52YXMgPSB0aGlzLl9yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICB9XG5cblxuICAgIGNvbnN0IGN0eCA9IHRoaXMubWVhc3VyZUNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGNvbnN0IGlucHV0UmVmID0gdGhpcy5fY29udHJvbC5lbGVtZW50UmVmO1xuICAgIGNvbnN0IHN0eWxlcyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGlucHV0UmVmLm5hdGl2ZUVsZW1lbnQpO1xuICAgIGN0eC5mb250ID0gZ2V0Rm9udFNob3J0aGFuZChzdHlsZXMpO1xuXG4gICAgY29uc3QgbWV0cmljcyA9IGN0eC5tZWFzdXJlVGV4dCh0aGlzLl9jb250cm9sLnZhbHVlKTtcbiAgICAvLyBhZGQgMXB4IChjdXJzb3Igd2lkdGgpIHRvIHByZXZlbnQganVtcGluZyBvZiB0aGUgdGV4dCBvbiBibHVyLlxuICAgIGNvbnN0IG5ld1dpZHRoID0gbWV0cmljcy53aWR0aCArIHBhcnNlSW50KHN0eWxlcy5wYWRkaW5nUmlnaHQsIDEwKSArIHBhcnNlSW50KHN0eWxlcy5wYWRkaW5nTGVmdCwgMTApICsgMTtcblxuICAgIC8vIFRoaXMgc2hvdWxkIGJlIGluamVjdGVkIHZpYSBASG9zdCB0byBnZXQgYW4gZXhhY3QgcmVmZXJlbmNlIHRvIE54TmF0dXJhbExhbmd1YWdlRm9ybUNvbXBvbmVudFxuICAgIC8vIFdvcmtzIGFzIHByb21pc2VkIGFzIGxvbmcgYXMgdGhlcmUgaXMgbm90IG90aGVyIHRhZyBhcm91bmQgdGhlIHdvcmQuIE5vdCBleHBlY3RlZCBidXQgcG9zc2libGUuXG4gICAgY29uc3QgcGFyZW50OiBIVE1MRWxlbWVudCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgcGFyZW50TWVhc3VyZW1lbnQgPSBwYXJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAvLyBMaW1pdCB0byBvd24gZ2l2ZW4gbWluaW1hbCB3aWR0aFxuICAgIHRoaXMuY3VycmVudFRleHRXaWR0aCA9IE1hdGgubWF4KHBhcnNlSW50KHN0eWxlcy5taW5XaWR0aCwgMTApLCBuZXdXaWR0aCk7XG5cbiAgICAvLyBMaW1pdCB0byBjb250YWluZXIgd2lkdGhcbiAgICB0aGlzLmN1cnJlbnRUZXh0V2lkdGggPSBNYXRoLm1pbih0aGlzLmN1cnJlbnRUZXh0V2lkdGgsIHBhcmVudE1lYXN1cmVtZW50LndpZHRoKTtcbiAgICB0aGlzLl9wb3BvdmVyLnVwZGF0ZVBvc2l0aW9uKCk7XG4gIH1cblxuICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICByZXBvc2l0aW9uRXJyb3IoKSB7XG4gICAgaWYgKHRoaXMuX3BvcG92ZXIpIHtcbiAgICAgIHRoaXMuX3BvcG92ZXIudXBkYXRlUG9zaXRpb24oKTtcbiAgICB9XG4gIH1cblxuICAvLyBGYWlsIGlmIHRoZSByZXF1aXJlZCBjb250cm9sIGlzIG1pc3NpbmcuXG4gIHByb3RlY3RlZCBfdmFsaWRhdGVDb250cm9sQ2hpbGQoKSB7XG4gICAgaWYgKCF0aGlzLl9jb250cm9sKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ054V29yZENvbXBvbmVudCByZXF1aXJlcyBhbiBOeEZvcm1maWVsZENvbnRyb2wgY29tcGF0aWJsZSBpbnB1dC4nKTtcbiAgICB9XG4gIH1cblxuICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICBnZXRDb25uZWN0ZWRPdmVybGF5T3JpZ2luKCk6IEVsZW1lbnRSZWYge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRSZWY7XG4gIH1cblxuICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICBnZXQgaXNGb2N1c2VkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9jb250cm9sLmZvY3VzZWQ7XG4gIH1cblxuICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICBnZXQgaXNGaWxsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLl9jb250cm9sLmVtcHR5O1xuICB9XG5cbiAgLyoqIEBkb2NzLXByaXZhdGUgKi9cbiAgZ2V0IGhhc0Ryb3Bkb3duKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMuX2Ryb3Bkb3duKTtcbiAgfVxufVxuIl19