# NDBX Angular Component Library

üìö Global NDBX component library for Angular.

Browse the [Documentation & Examples][docs]
or jump into action with the [sample app](https://github.developer.allianz.io/ilt/ndbx-sample-app) and its [preview](https://github.developer.allianz.io/pages/ilt/ndbx-sample-app/).

If you want to contribute, please read the **[Contribution Guidelines](CONTRIBUTING.md)**.

---

## Table of contents

- [Installation](#installation)
- [Usage](#usage)
- [Peer Dependencies](#peer-dependencies)
- [Development](#development)
- [Troubleshooting](#troubleshooting)
- [Resources](#resources)


## Installation
Before we can start coding, we need to change our npm registry endpoint, install all dependencies and let Angular load our external CSS files (from PatternLab).

### Additional NPM Registry
All involved packages are scoped to `@allianz` and published on the GDF nexus, so you need to register it as your registry endpoint for this scope.

You can do so by running the following command on your system. This will update your global `~/.npmrc` file.

**Impact:** npm will fetch any package with the scope `@allianz` from the GDF Nexus.
**Note:** Build processes that run within the Allianz network should use https://gdf-nexus.dev.adp.allianz/gdf-nexus to proxify GDF Nexus repository properly.

```bash
# use those values in the following prompt
# username: gdf-npm-read
# password: gdf
# email: gdf-npm-read@allianz.com
npm adduser --registry=https://api-dev.allianz.com/gdf-nexus/repository/npm-all/ --scope=@allianz --always-auth
```
see [npm adduser](https://docs.npmjs.com/cli/adduser) for more details.

Alternatively, you can drop in an .npmrc file with the following content (as present in this project):

```bash
registry=https://api-dev.allianz.com/gdf-nexus/repository/npm-all/
email=gdf-npm-read@allianz.com
always-auth=true
_auth=Z2RmLW5wbS1yZWFkOmdkZg==
```

Please be careful with this ‚ö†Ô∏è

This provides read-only access to the Nexus repository and is not meant to be used outside of the Allianz scope. So please don't distribute or commit this in a public repository like github.com.

### Install Angular NDBX, the Styles and the Angular CDK

```shell
npm install @allianz/ngx-ndbx@7.* install @allianz/ndbx-styles @angular/cdk --save
```

The package [@allianz/ndbx-styles][ndbx-styles] will contain a minimal Patternlab CSS (starting with version 1.28.0). This CSS will setup fonts and do some resets. The rest of the PatternLab styles are directly attached to the components starting with version 6.

We recommend that you switch to the minimal version if you are not using any markup directly from PatternLab. If you have classes prefixed with `c-` (component), `u-` (utility) or `t-` (theme) you still dependent on the full Patternlab CSS.

---

Import it from your existing sass/css environment (`style.css`)
with the following statement.

```scss
@import "@allianz/ndbx-styles/dist/patternlab.min.css";
```

To use the minimal version import the file `@allianz/ndbx-styles/dist/patternlab-minimal.css` instead.

## Usage
Start using the library by importing the appropriate modules into your application modules.
We have enabled view encapsulation for all components so every component will bring it's own CSS.

```typescript

// <-- app.module.ts -->
import { NxCheckboxModule, NxButtonModule } from '@allianz/ngx-ndbx';

@NgModule({
    imports: [
        NxButtonModule,
        NxCheckboxModule
    ]
})

```

Then use the components.


```html

<button nxButton>I'm a button</button>
<nx-checkbox>Check me</nx-checkbox>
```

## Peer Dependencies
We have some peer dependencies in place.

```
"@angular/core": "^7.0.0",
"@angular/common": "^7.0.0",
"@angular/cdk": "^7.0.0",
"@angular/animations": "^7.0.0",
"moment": "^2.20.1",
"object-fit-images": "^3.2.3"
```

That means you have to ensure they are in place. `@angular/core` and `@angular/common` are obvious dependencies.

The CDK is only required for some modules like Popover and Dropdown as we use the Overlay component. We will clearly mark those components so you always know if you need the CDK.

The CSS for the overlay need to be pulled in when you use Dropdown, Datefield with Datepicker or Popover.

```
# File: .angular-cli.json

"styles": [
  "node_modules/@angular/cdk/overlay-prebuilt.css"
  "styles.scss"
],

# Or in your scss file
@import 'node_modules/@angular/cdk/overlay-prebuilt.css';

```

At the moment, animations are only required by the Modal component.

Moment is needed for the Datepicker if you choose to use the MomentAdapter.

`object-fit-images` is only required by the Image component.

### BrowserAnimationsModule
In case you need the BrowserAnimationsModule because you're using a NDBX module that requires it: Check if your application already imports the `BrowserAnimationsModule` or, if you do not want animations, the `NoopAnimationsModule`. If not, you need to install `@angular/animations` and import either one of these modules in your root level application module.

```typescript

// <-- app.module.ts -->
import { BrowserModule } from '@angular/platform-browser';
import { BrowserAnimationsModule } from '@angular/platform-browser/animations';

@NgModule({
    imports: [
    BrowserModule,
    BrowserAnimationsModule,
    //...
    ]

})
```

## Development
To access the documentation, clone this project and run the following commands:

```shell

# Install all dependencies
npm install

# Run the viewer to access the documentation
npm start

```

This will start a local webserver [serving the documentation](http://localhost:4200/) which is using
the integrated sources of the library. This allows you to extend the library and the documentation.

### Building
Run the following script to build the viewer application.

```shell
$ npm run build
```

This will create a deployable build in the folder `dist`.

Run the following script to build the library:

```shell
$ npm run build:lib
```

If you want to ensure the library is working in AOT mode you can run an integrated build which will first build the library
and the viewer using the built library instead of the raw sources.

```shell
$  npm run build:integrated
```

It will create the build in `dist` ready to be published.
This is powered by [ng-packagr](https://github.com/dherges/ng-packagr) which generates the necessary bundles to be consumed by most build systems.

### Deployment
+ The documentation is currently deployed [here](https://api-test.allianz.com/ngx-ndbx-dev/my-viewer/) whenever the master branch is changed.
+ The library is published if the version in the `package.json` of the `master` is incremented. 
+ We follow semantic versioning and provide beta releases for larger changes.  

## Troubleshooting
### EINTEGRITY npm error

Make sure you have **`npm@5.6.0`** installed if you use npm and not yarn locally. Otherwise you might run into the `EINTEGRITY` problem. See this [issue](https://github.developer.allianz.io/ilt/ngx-ndbx/issues/3) for reference.

## Resources
Some useful links.

+ [Creators - New Allianz Brand Experience][creators]
+ [Pattern Lab Git (NDBX)][patternlab-git]

[Creators]:https://creators.allianz.com/
[patternlab-git]: https://github.developer.allianz.io/oneMarketing/pattern-lab
[docs]: https://api-test.allianz.com/ngx-ndbx-next/
[ndbx-styles]: https://github.developer.allianz.io/ilt/ndbx-styles
